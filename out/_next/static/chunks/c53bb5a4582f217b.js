(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73884,e=>{"use strict";let s=(0,e.i(75254).default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>s],73884)},86536,e=>{"use strict";let s=(0,e.i(75254).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>s],86536)},69638,e=>{"use strict";let s=(0,e.i(75254).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>s],69638)},71689,e=>{"use strict";let s=(0,e.i(75254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],71689)},38533,e=>{"use strict";var s=e.i(64397);e.s(["loanService",0,{getLoans:async e=>{let t=new URLSearchParams;e.search&&t.append("search",e.search),e.status&&t.append("status",e.status),e.page&&t.append("page",e.page.toString()),e.per_page&&t.append("per_page",e.per_page.toString());let a=await fetch(`${s.API_BASE_URL}/loans?${t.toString()}`,{headers:(0,s.getHeaders)()}),r=await a.json();if(!a.ok)throw Error(r.message||"Failed to fetch loans");return r},createLoan:async e=>{let t=await fetch(`${s.API_BASE_URL}/loans`,{method:"POST",headers:(0,s.getHeaders)(),body:JSON.stringify(e)}),a=await t.json();if(!t.ok){let e=a.message||"Failed to submit loan application";if(a.errors){let s=Object.values(a.errors).flat().join(", ");e+=`: ${s}`}throw Error(e)}return a.data},getLoanById:async e=>{let t=await fetch(`${s.API_BASE_URL}/loans/${e}`,{headers:(0,s.getHeaders)()}),a=await t.json();if(!t.ok)throw Error(a.message||"Failed to fetch loan details");return a.data},approveLoan:async(e,t,a)=>{let r=await fetch(`${s.API_BASE_URL}/loans/${e}/approve`,{method:"PATCH",headers:(0,s.getHeaders)(),body:JSON.stringify({action:t,reason:a})}),l=await r.json();if(!r.ok)throw Error(l.message||"Failed to approve loan");return l.data},exportLoans:async()=>{let e=await fetch(`${s.API_BASE_URL}/loans/export`,{headers:(0,s.getHeaders)()});if(!e.ok)throw Error((await e.json().catch(()=>({}))).message||"Failed to export loans");let t=await e.blob(),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`loans_export_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r)},importLoans:async e=>{let t=new FormData;t.append("file",e);let a=await fetch(`${s.API_BASE_URL}/loans/import`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:t}),r=await a.json();if(!a.ok)throw Error(r.message||"Failed to import loans");return r}}])},72520,e=>{"use strict";let s=(0,e.i(75254).default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>s],72520)},27331,e=>{"use strict";let s=["Completed","Rejected"];e.s(["LOAN_CLOSED_STATUSES",0,s,"LOAN_STATUS_APPROVED",0,"approved","LOAN_STATUS_PENDING_1ST",0,"pending_1st","LOAN_STATUS_PENDING_2ND",0,"pending_2nd","LOAN_STATUS_SENT_BACK",0,"sent_back","isLoanClosed",0,e=>s.includes(e)])},67276,e=>{"use strict";var s=e.i(43476),t=e.i(69638);e.s(["ProgressSteps",0,({steps:e,currentStep:a,onStepClick:r})=>(0,s.jsx)("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:(0,s.jsx)("div",{className:"flex items-center justify-between",children:e.map((l,n)=>{let i=!!r,c=a>=l.number,d=a===l.number;return(0,s.jsxs)("div",{className:"flex items-center flex-1 last:flex-none",children:[(0,s.jsxs)("div",{className:`flex items-center gap-3 group ${i?"cursor-pointer":""}`,onClick:()=>i&&r(l.number),children:[(0,s.jsx)("div",{className:`w-11 h-11 rounded-2xl flex items-center justify-center transition-all duration-300 ${c?"bg-blue-600 text-white shadow-xl shadow-blue-100 ring-4 ring-blue-50":"bg-gray-100 text-gray-400 group-hover:bg-gray-200"} ${d?"scale-110":""}`,children:a>l.number?(0,s.jsx)(t.CheckCircle,{className:"w-6 h-6"}):(0,s.jsx)("div",{className:"transition-transform group-hover:scale-110",children:l.icon})}),(0,s.jsxs)("div",{className:"hidden lg:block",children:[(0,s.jsx)("p",{className:`text-[13px] font-black uppercase tracking-wider transition-colors ${c?"text-gray-900":"text-gray-400"}`,children:l.title}),(0,s.jsx)("p",{className:`text-[10px] font-bold transition-colors ${c?"text-blue-500":"text-gray-400"}`,children:l.description})]})]}),n<e.length-1&&(0,s.jsx)("div",{className:`flex-1 h-1 mx-6 rounded-full transition-all duration-500 ${a>l.number?"bg-blue-600 shadow-[0_0_10px_rgba(37,99,235,0.3)]":"bg-gray-100"}`})]},l.number)})})})])},34102,e=>{"use strict";let s=e=>Number(e.processingFee||0)+Number(e.documentationFee||0)+Number(e.insuranceFee||0);e.s(["calculateNetDisbursement",0,e=>Number(e.loanAmount||0)-s(e),"calculateTotalFees",0,s,"extractGenderFromNIC",0,e=>{let s=e.toUpperCase().trim(),t=0;if(/^(\d{9})[VX]$/.test(s))t=parseInt(s.substring(2,5));else{if(!/^(\d{12})$/.test(s))return null;t=parseInt(s.substring(4,7))}return t>500?"Female":"Male"},"formatCurrency",0,e=>`LKR ${e.toLocaleString()}`,"generateDraftName",0,(e,s,t)=>e?.displayName||(s?`NIC ${s}`:t||"Untitled draft"),"isValidNIC",0,e=>/^([0-9]{9}[x|X|v|V]|[0-9]{12})$/.test(e.trim())])},39498,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(38533),r=e.i(70319),l=e.i(27331),n=e.i(55436);let i=({searchTerm:e,onSearchChange:t,filterStatus:a,onStatusChange:r})=>(0,s.jsx)("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(n.Search,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),(0,s.jsx)("input",{type:"text",placeholder:"Search by contract no, customer name, or NIC...",value:e,onChange:e=>t(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("select",{value:a,onChange:e=>r(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"all",children:"All Pending"}),(0,s.jsx)("option",{value:"Pending 1st",children:"Pending 1st Approval"}),(0,s.jsx)("option",{value:"Pending 2nd",children:"Pending 2nd Approval"})]})]})});var c=e.i(86536),d=e.i(63209);let o=({loans:e,onView:t})=>(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left px-6 py-3 text-xs text-gray-600 uppercase tracking-wider",children:"Serial"}),(0,s.jsx)("th",{className:"text-left px-6 py-3 text-xs text-gray-600 uppercase tracking-wider",children:"Contract No"}),(0,s.jsx)("th",{className:"text-left px-6 py-3 text-xs text-gray-600 uppercase tracking-wider",children:"Customer Name"}),(0,s.jsx)("th",{className:"text-left px-6 py-3 text-xs text-gray-600 uppercase tracking-wider",children:"NIC"}),(0,s.jsx)("th",{className:"text-right px-6 py-3 text-xs text-gray-600 uppercase tracking-wider",children:"Loan Amount"}),(0,s.jsx)("th",{className:"text-left px-6 py-3 text-xs text-gray-600 uppercase tracking-wider",children:"Staff"}),(0,s.jsx)("th",{className:"text-left px-6 py-3 text-xs text-gray-600 uppercase tracking-wider",children:"Submitted Date"}),(0,s.jsx)("th",{className:"text-center px-6 py-3 text-xs text-gray-600 uppercase tracking-wider",children:"1st Approval"}),(0,s.jsx)("th",{className:"text-center px-6 py-3 text-xs text-gray-600 uppercase tracking-wider",children:"2nd Approval"}),(0,s.jsx)("th",{className:"text-center px-6 py-3 text-xs text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200",children:e.map(e=>{var a,r;let l,n=(a=e.submittedDate,r=e.submittedTime,l=new Date(`${a} ${r}`),(new Date().getTime()-l.getTime())/36e5>1);return(0,s.jsxs)("tr",{className:`hover:bg-gray-50 ${n?"bg-orange-50":""}`,children:[(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.serialNo}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-900",children:e.contractNo}),n&&(0,s.jsx)("span",{title:"Over 1 hour pending",children:(0,s.jsx)(d.AlertCircle,{className:"w-4 h-4 text-orange-600"})})]})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.customerName}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.nic}),(0,s.jsxs)("td",{className:"px-6 py-4 text-sm text-right text-gray-900",children:["LKR ",e.loanAmount.toLocaleString()]}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.staff}),(0,s.jsxs)("td",{className:"px-6 py-4 text-sm text-gray-600",children:[(0,s.jsx)("div",{children:e.submittedDate}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.submittedTime})]}),(0,s.jsxs)("td",{className:"px-6 py-4 text-center",children:["Pending"===e.firstApproval&&(0,s.jsx)("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs",children:"Pending"}),"Approved"===e.firstApproval&&(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsx)("div",{className:"text-green-600",children:"Approved"}),(0,s.jsx)("div",{className:"text-gray-500",children:e.firstApprovalDate})]}),"Sent Back"===e.firstApproval&&(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsx)("div",{className:"text-red-600",children:"Sent Back"}),(0,s.jsx)("div",{className:"text-gray-500",children:e.firstApprovalDate})]})]}),(0,s.jsx)("td",{className:"px-6 py-4 text-center",children:null===e.secondApproval&&e.loanAmount<=2e5?(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"N/A"}):"Pending"===e.secondApproval?(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs",children:"Pending"}):"Approved"===e.secondApproval?(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsx)("div",{className:"text-green-600",children:"Approved"}),(0,s.jsx)("div",{className:"text-gray-500",children:e.secondApprovalDate})]}):"Sent Back"===e.secondApproval?(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsx)("div",{className:"text-red-600",children:"Sent Back"}),(0,s.jsx)("div",{className:"text-gray-500",children:e.secondApprovalDate})]}):(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}),(0,s.jsx)("td",{className:"px-6 py-4 text-center",children:(0,s.jsx)("button",{onClick:()=>t(e),className:"text-blue-600 hover:text-blue-800",children:(0,s.jsx)(c.Eye,{className:"w-5 h-5"})})})]},e.id)})})]})})});var x=e.i(69638),m=e.i(73884),p=e.i(84614),h=e.i(12426),u=e.i(81418),g=e.i(71689),b=e.i(72520);let f=({status:e})=>{switch(e){case"Pending 1st":return(0,s.jsx)("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs",children:"Pending 1st Approval"});case"Pending 2nd":return(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs",children:"Pending 2nd Approval"});case"Approved":return(0,s.jsxs)("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs inline-flex items-center gap-1",children:[(0,s.jsx)(x.CheckCircle,{className:"w-3 h-3"}),"Approved"]});case"Sent Back":return(0,s.jsxs)("span",{className:"px-2 py-1 bg-red-100 text-red-700 rounded text-xs inline-flex items-center gap-1",children:[(0,s.jsx)(m.XCircle,{className:"w-3 h-3"}),"Sent Back"]});default:return(0,s.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs",children:e})}};var N=e.i(42365),j=e.i(67276),y=e.i(34102);let v=({loan:e,onClose:a,onFirstApproval:r,onSecondApproval:l})=>{let[n,i]=(0,t.useState)(()=>"Pending 2nd"===e.status?4:"Pending 1st"===e.status||"Sent Back"===e.status?3:1),[c,o]=(0,t.useState)(""),[v,w]=(0,t.useState)(!1),A=N.authService.hasRole("manager")||N.authService.hasRole("super_admin"),k=N.authService.hasRole("admin")||N.authService.hasRole("super_admin"),S=N.authService.hasRole("field_officer")||N.authService.hasRole("staff"),C=[{number:1,title:"Customer Info",description:"Identity verification",icon:(0,s.jsx)(p.User,{className:"w-4 h-4"})},{number:2,title:"Loan Details",description:"Financial summary",icon:(0,s.jsx)(h.DollarSign,{className:"w-4 h-4"})},{number:3,title:"1st Approval",description:"Manager level review",icon:(0,s.jsx)(x.CheckCircle,{className:"w-4 h-4"})},{number:4,title:"2nd Approval",description:e.loanAmount>=2e5?"Admin level review":"Not Required",icon:(0,s.jsx)(u.ShieldCheck,{className:"w-4 h-4"})}];return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-[2.5rem] max-w-4xl w-full max-h-[95vh] overflow-hidden flex flex-col shadow-[0_25px_50px_-12px_rgba(0,0,0,0.3)] ring-1 ring-black/5",children:[(0,s.jsxs)("div",{className:"px-8 py-6 border-b border-gray-100 bg-gray-50/50 flex items-center justify-between shrink-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-5",children:[(0,s.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-blue-700 rounded-3xl flex items-center justify-center text-white shadow-xl shadow-blue-100 ring-2 ring-white",children:(0,s.jsx)(u.ShieldCheck,{className:"w-7 h-7"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("h2",{className:"text-2xl font-black text-gray-900 tracking-tight",children:e.contractNo}),(0,s.jsx)(f,{status:e.status})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 flex items-center gap-2 mt-0.5 font-bold",children:[(0,s.jsx)(p.User,{className:"w-4 h-4 text-blue-500"}),e.customerName]})]})]}),(0,s.jsx)("button",{onClick:a,className:"w-12 h-12 flex items-center justify-center rounded-2xl hover:bg-white hover:shadow-md text-gray-400 hover:text-red-500 transition-all border border-transparent hover:border-gray-100",children:(0,s.jsx)(m.XCircle,{className:"w-7 h-7"})})]}),(0,s.jsx)("div",{className:"px-8 py-5 border-b border-gray-50 shrink-0 overflow-x-auto bg-white/50",children:(0,s.jsx)(j.ProgressSteps,{steps:C,currentStep:n,onStepClick:i})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-8 md:p-10 bg-white/50",children:(0,s.jsx)("div",{className:"max-w-3xl mx-auto",children:(()=>{let{rawLoan:t}=e;switch(n){case 1:return(0,s.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300",children:["Sent Back"===e.status&&e.rejectionReason&&(0,s.jsxs)("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-2xl p-6 flex items-start gap-4 mb-8",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center text-orange-600 shrink-0 border border-orange-200",children:(0,s.jsx)(d.AlertCircle,{className:"w-6 h-6"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-black text-orange-900 text-sm uppercase tracking-wider",children:"Modification Required"}),(0,s.jsxs)("p",{className:"text-sm font-medium text-orange-800 mt-1 leading-relaxed",children:['"',e.rejectionReason,'"']})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-sm",children:[(0,s.jsxs)("h3",{className:"text-sm font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),"Customer Profile"]}),(0,s.jsxs)("div",{className:"space-y-3.5 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium",children:"Full Name"}),(0,s.jsx)("span",{className:"font-bold text-gray-900",children:e.customerName})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium",children:"NIC Number"}),(0,s.jsx)("span",{className:"font-bold text-gray-900",children:e.nic})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium",children:"Center"}),(0,s.jsx)("span",{className:"font-bold text-gray-900",children:e.loanDetails.center})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium",children:"Group"}),(0,s.jsx)("span",{className:"font-bold text-gray-900",children:e.loanDetails.group})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center bg-blue-50/50 -mx-6 px-6 py-2 mt-2",children:[(0,s.jsx)("span",{className:"text-blue-600 font-bold text-xs uppercase tracking-tight",children:"Branch Manager"}),(0,s.jsx)("span",{className:"font-black text-gray-900 text-sm",children:e.loanDetails.branchManager})]})]})]}),(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-sm",children:[(0,s.jsxs)("h3",{className:"text-sm font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),"Guardian Info"]}),(0,s.jsxs)("div",{className:"space-y-3.5 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center text-right",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium text-left",children:"Name"}),(0,s.jsx)("span",{className:"font-bold text-gray-900",children:t?.guardian_name||"N/A"})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium",children:"Phone"}),(0,s.jsx)("span",{className:"font-bold text-gray-900",children:t?.guardian_phone||"N/A"})]}),(0,s.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium shrink-0",children:"Address"}),(0,s.jsx)("span",{className:"font-bold text-gray-900 text-right leading-tight",children:t?.guardian_address||"N/A"})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-sm",children:[(0,s.jsxs)("h3",{className:"text-sm font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),"Guarantors Details"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-8 text-sm",children:[(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-100",children:[(0,s.jsx)("p",{className:"text-gray-500 font-bold text-[10px] uppercase tracking-wider mb-2",children:"Guarantor 01"}),(0,s.jsx)("p",{className:"font-bold text-gray-900 text-base",children:t?.g1_details?.name||"N/A"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 font-medium mt-1",children:["NIC: ",t?.g1_details?.nic||"N/A"]})]}),(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-100",children:[(0,s.jsx)("p",{className:"text-gray-500 font-bold text-[10px] uppercase tracking-wider mb-2",children:"Guarantor 02"}),(0,s.jsx)("p",{className:"font-bold text-gray-900 text-base",children:t?.g2_details?.name||"N/A"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 font-medium mt-1",children:["NIC: ",t?.g2_details?.nic||"N/A"]})]})]})]})]});case 2:return(0,s.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-sm",children:[(0,s.jsxs)("h3",{className:"text-sm font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),"Loan Assessment"]}),(0,s.jsxs)("div",{className:"space-y-3.5 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium",children:"Loan Amount"}),(0,s.jsx)("span",{className:"font-black text-gray-900 text-lg",children:(0,y.formatCurrency)(e.loanAmount)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium",children:"Interest Rate"}),(0,s.jsxs)("span",{className:"font-bold text-gray-900",children:[e.loanDetails.interestRate,"% Monthly"]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium",children:"Tenure"}),(0,s.jsxs)("span",{className:"font-bold text-gray-900",children:[e.loanDetails.tenure," months"]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-500 font-medium",children:"Loan Step"}),(0,s.jsx)("span",{className:"font-bold text-gray-900",children:e.loanDetails.purpose})]})]})]}),(0,s.jsxs)("div",{className:"bg-blue-600 rounded-2xl p-6 shadow-xl shadow-blue-100 text-white relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 right-0 p-8 opacity-10",children:(0,s.jsx)(u.ShieldCheck,{className:"w-24 h-24"})}),(0,s.jsxs)("h3",{className:"text-sm font-bold text-blue-100 mb-4 flex items-center gap-2 relative z-10",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-white rounded-full"}),"Disbursement Summary"]}),(0,s.jsxs)("div",{className:"space-y-3.5 text-sm relative z-10",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-blue-100",children:"Approved Amount"}),(0,s.jsx)("span",{className:"font-bold",children:(0,y.formatCurrency)(e.loanAmount)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-blue-100",children:"Deducted Fees"}),(0,s.jsxs)("span",{className:"font-bold",children:["- ",(0,y.formatCurrency)(Number(t?.service_charge||0)+Number(t?.document_charge||0))]})]}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-blue-400 flex justify-between items-end",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[10px] text-blue-200 uppercase font-black tracking-widest",children:"Net Payable"}),(0,s.jsx)("p",{className:"text-2xl font-black",children:(0,y.formatCurrency)(e.loanAmount-(Number(t?.service_charge||0)+Number(t?.document_charge||0)))})]})})]})]})]}),(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-sm",children:[(0,s.jsxs)("h3",{className:"text-sm font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),"Internal References"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-8 text-sm text-gray-600",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-wider mb-1",children:"Witness 01 (Verified Staff)"}),(0,s.jsx)("p",{className:"font-bold text-gray-900",children:t?.w1_details?.name||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-wider mb-1",children:"Witness 02 (Verified Staff)"}),(0,s.jsx)("p",{className:"font-bold text-gray-900",children:t?.w2_details?.name||"N/A"})]})]})]})]});case 3:return(0,s.jsxs)("div",{className:"space-y-8 py-8 animate-in zoom-in-95 duration-300",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center space-y-4",children:[(0,s.jsx)("div",{className:`w-20 h-20 rounded-3xl flex items-center justify-center transition-all ${"Approved"===e.firstApproval?"bg-green-100 text-green-600":"bg-orange-100 text-orange-600"}`,children:"Approved"===e.firstApproval?(0,s.jsx)(x.CheckCircle,{className:"w-10 h-10"}):(0,s.jsx)(u.ShieldCheck,{className:"w-10 h-10"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-2xl font-black text-gray-900",children:"1st Level Approval"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"Standard validation required for all loan disbursements"})]})]}),"Pending"===e.firstApproval?(0,s.jsx)("div",{className:"bg-white border-2 border-dashed border-gray-200 rounded-3xl p-10 flex flex-col items-center shadow-sm",children:A?(0,s.jsxs)("div",{className:"space-y-8 w-full",children:[(0,s.jsxs)("div",{className:"bg-blue-50/50 p-4 rounded-2xl border border-blue-100 flex items-start gap-4 mx-auto max-w-lg",children:[(0,s.jsx)(d.AlertCircle,{className:"w-5 h-5 text-blue-600 shrink-0 mt-0.5"}),(0,s.jsx)("p",{className:"text-sm text-blue-800 leading-relaxed",children:"By approving this, you confirm that you have verified the customer identity, guarantor availability, and the specified loan terms are accurate."})]}),v?(0,s.jsxs)("div",{className:"space-y-4 max-w-lg mx-auto animate-in fade-in slide-in-from-top-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-black text-gray-700 mb-2",children:"Rejection reason / Modification required"}),(0,s.jsx)("textarea",{value:c,onChange:e=>o(e.target.value),placeholder:"Please explain why this is being sent back...",className:"w-full px-4 py-3 rounded-2xl border-2 border-orange-100 focus:border-orange-500 focus:ring-4 focus:ring-orange-50 outline-none transition-all resize-none h-32 text-sm font-medium"})]}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:()=>w(!1),className:"flex-1 py-3.5 bg-gray-100 text-gray-600 font-bold rounded-2xl hover:bg-gray-200 transition-all",children:"Cancel"}),(0,s.jsx)("button",{onClick:()=>r(e.id,"sendback",c),disabled:!c.trim(),className:"flex-1 py-3.5 bg-orange-600 text-white font-black rounded-2xl hover:bg-orange-700 disabled:opacity-50 shadow-xl shadow-orange-100 transition-all",children:"Submit Rejection"})]})]}):(0,s.jsxs)("div",{className:"flex justify-center gap-6",children:[(0,s.jsxs)("button",{onClick:()=>w(!0),className:"group flex items-center gap-3 px-10 py-4 bg-white border-2 border-orange-600 text-orange-600 font-black rounded-2xl hover:bg-orange-600 hover:text-white transition-all transform hover:-translate-y-1 active:scale-95",children:[(0,s.jsx)(m.XCircle,{className:"w-6 h-6"}),"Send Back"]}),(0,s.jsxs)("button",{onClick:()=>r(e.id,"approve"),className:"flex items-center gap-3 px-12 py-4 bg-green-600 text-white font-black rounded-2xl hover:bg-green-700 shadow-xl shadow-green-200 transition-all transform hover:-translate-y-1 active:scale-95",children:[(0,s.jsx)(x.CheckCircle,{className:"w-6 h-6"}),"Confirm Approval"]})]})]}):(0,s.jsxs)("div",{className:"flex items-center gap-4 bg-orange-50 p-6 rounded-2xl text-orange-700 border border-orange-100 max-w-md",children:[(0,s.jsx)(u.ShieldCheck,{className:"w-8 h-8 opacity-50"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-black text-sm uppercase tracking-wider",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-xs font-medium mt-1 leading-relaxed italic opacity-80",children:"Only staff with 'Manager' privileges are authorized to perform this review step."})]})]})}):(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-3xl p-10 flex flex-col items-center gap-4 shadow-sm shadow-green-50",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-green-600 rounded-full flex items-center justify-center text-white",children:(0,s.jsx)(x.CheckCircle,{className:"w-6 h-6"})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"font-black text-green-900 text-xl",children:"1st Level Completed"}),(0,s.jsxs)("p",{className:"text-sm font-medium text-green-700 mt-1",children:["Verified by: ",(0,s.jsx)("span",{className:"font-black",children:e.firstApprovalDate||e.loanDetails.branchManager||"Branch Manager"})]}),(0,s.jsx)("p",{className:"text-xs text-green-600 font-bold mt-2 italic",children:"Application successfully verified at the branch level."})]})]})]});case 4:return(0,s.jsxs)("div",{className:"space-y-8 py-8 animate-in zoom-in-95 duration-300",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center space-y-4",children:[(0,s.jsx)("div",{className:`w-20 h-20 rounded-3xl flex items-center justify-center transition-all ${"Approved"===e.secondApproval?"bg-green-100 text-green-600":e.loanAmount>=2e5?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-400"}`,children:(0,s.jsx)(u.ShieldCheck,{className:"w-10 h-10"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-2xl font-black text-gray-900",children:"2nd Level Approval"}),e.loanAmount>=2e5?(0,s.jsx)("p",{className:"text-sm text-gray-500 font-medium italic",children:"High amount protection: Final administrative sign-off required"}):(0,s.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"Automatic verification bypass for standard loan amounts"})]})]}),e.loanAmount>=2e5?"Pending"===e.secondApproval?(0,s.jsx)("div",{className:"bg-white border-2 border-dashed border-gray-200 rounded-3xl p-10 flex flex-col items-center shadow-sm",children:k?(0,s.jsxs)("div",{className:"space-y-8 w-full",children:[(0,s.jsxs)("div",{className:"bg-red-50/50 p-4 rounded-2xl border border-red-100 flex items-start gap-4 mx-auto max-w-lg",children:[(0,s.jsx)(d.AlertCircle,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),(0,s.jsx)("p",{className:"text-sm text-red-800 leading-relaxed font-medium",children:"Critical Action: You are performing the final secondary review for a high-value loan (> LKR 200k)."})]}),v?(0,s.jsxs)("div",{className:"space-y-4 max-w-lg mx-auto animate-in fade-in slide-in-from-top-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-black text-gray-700 mb-2",children:"Rejection reason / Modification required"}),(0,s.jsx)("textarea",{value:c,onChange:e=>o(e.target.value),placeholder:"Please explain why this is being sent back...",className:"w-full px-4 py-3 rounded-2xl border-2 border-red-100 focus:border-red-500 focus:ring-4 focus:ring-red-50 outline-none transition-all resize-none h-32 text-sm font-medium"})]}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:()=>w(!1),className:"flex-1 py-3.5 bg-gray-100 text-gray-600 font-bold rounded-2xl hover:bg-gray-200 transition-all",children:"Cancel"}),(0,s.jsx)("button",{onClick:()=>l(e.id,"sendback",c),disabled:!c.trim(),className:"flex-1 py-3.5 bg-red-600 text-white font-black rounded-2xl hover:bg-red-700 disabled:opacity-50 shadow-xl shadow-red-100 transition-all",children:"Submit Rejection"})]})]}):(0,s.jsxs)("div",{className:"flex justify-center gap-6",children:[(0,s.jsxs)("button",{onClick:()=>w(!0),className:"group flex items-center gap-3 px-10 py-4 bg-white border-2 border-orange-600 text-orange-600 font-black rounded-2xl hover:bg-orange-600 hover:text-white transition-all transform hover:-translate-y-1 active:scale-95",children:[(0,s.jsx)(m.XCircle,{className:"w-6 h-6"}),"Reject / Back"]}),(0,s.jsxs)("button",{onClick:()=>l(e.id,"approve"),className:"flex items-center gap-3 px-12 py-4 bg-blue-600 text-white font-black rounded-2xl hover:bg-blue-700 shadow-xl shadow-blue-200 transition-all transform hover:-translate-y-1 active:scale-95",children:[(0,s.jsx)(x.CheckCircle,{className:"w-6 h-6"}),"Final Approval"]})]})]}):(0,s.jsxs)("div",{className:"flex items-center gap-4 bg-gray-100 p-6 rounded-2xl text-gray-600 border border-gray-200 max-w-md",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center border border-gray-200 shrink-0",children:(0,s.jsx)(u.ShieldCheck,{className:"w-6 h-6 opacity-30"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-black text-sm uppercase tracking-wider",children:"Admin Only Access"}),(0,s.jsx)("p",{className:"text-xs font-medium mt-1 leading-relaxed opacity-70",children:"Escalated approval stage. Requires Administrative or Executive level overrides."})]})]})}):(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-3xl p-10 flex flex-col items-center gap-4 shadow-sm",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white",children:(0,s.jsx)(x.CheckCircle,{className:"w-6 h-6"})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"font-black text-blue-900 text-xl text-center",children:"Finalized"}),(0,s.jsxs)("p",{className:"text-sm font-medium text-blue-700 mt-1",children:["Approved by: ",(0,s.jsx)("span",{className:"font-black",children:e.secondApprovalDate||"Administrator"})]}),(0,s.jsx)("p",{className:"text-xs text-blue-600 font-bold mt-2 italic max-w-[300px] mx-auto leading-relaxed",children:"Secondary administrative review complete. Loan is authorized for disbursement."})]})]}):(0,s.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-3xl p-10 flex flex-col items-center gap-4 border-dashed max-w-md mx-auto opacity-60",children:[(0,s.jsx)(d.AlertCircle,{className:"w-8 h-8 text-gray-400"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"font-bold text-gray-600 uppercase tracking-widest text-[10px]",children:"Information Only"}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500 mt-1",children:"This loan amount does not meet the criteria for secondary administrative approval."})]})]})]});default:return null}})()})}),(0,s.jsxs)("div",{className:"px-10 py-7 border-t border-gray-100 bg-gray-50 flex items-center justify-between shrink-0",children:[(0,s.jsxs)("button",{onClick:()=>i(e=>Math.max(1,e-1)),disabled:1===n,className:"flex items-center gap-2 px-8 py-3.5 bg-white border border-gray-200 text-gray-700 font-black rounded-2xl hover:bg-gray-100 disabled:opacity-30 disabled:hover:bg-white transition-all shadow-sm ring-1 ring-black/5",children:[(0,s.jsx)(g.ArrowLeft,{className:"w-4 h-4"}),"Previous"]}),(0,s.jsxs)("div",{className:"flex gap-4",children:[S&&("Pending 1st"===e.status||"Pending 2nd"===e.status||"Sent Back"===e.status)&&(0,s.jsx)("button",{onClick:()=>window.location.href=`/loans/create?edit=${e.id}`,className:"flex items-center gap-2 px-8 py-3.5 bg-orange-50 border border-orange-200 text-orange-600 font-black rounded-2xl hover:bg-orange-100 transition-all shadow-sm",children:"Edit Application"}),n<4?(0,s.jsxs)("button",{onClick:()=>i(e=>Math.min(4,e+1)),className:"flex items-center gap-2 px-10 py-3.5 bg-gray-900 text-white font-black rounded-2xl hover:bg-black shadow-xl shadow-gray-200 transition-all transform hover:-translate-y-0.5 active:scale-95",children:["Next Step",(0,s.jsx)(b.ArrowRight,{className:"w-4 h-4"})]}):(0,s.jsx)("button",{onClick:a,className:"px-12 py-3.5 bg-blue-600 text-white font-black rounded-2xl hover:bg-blue-700 shadow-xl shadow-blue-100 transition-all ring-4 ring-blue-50",children:"Close Modal"})]})]})]})})};function w(){let{searchTerm:e,setSearchTerm:n,filterStatus:c,setFilterStatus:d,viewingLoan:x,setViewingLoan:m,filteredLoans:p,handleFirstApproval:h,handleSecondApproval:u,isLoading:g,error:b}=function(){let[e,s]=(0,t.useState)([]),[n,i]=(0,t.useState)(!0),[c,d]=(0,t.useState)(null),[o,x]=(0,t.useState)(""),[m,p]=(0,t.useState)("all"),[h,u]=(0,t.useState)(null),g=e=>{let s=e.approval_level||0,t=s>0?"Approved":e.status===l.LOAN_STATUS_SENT_BACK?"Sent Back":"Pending",a="Pending 1st";e.status===l.LOAN_STATUS_PENDING_2ND&&(a="Pending 2nd"),e.status===l.LOAN_STATUS_APPROVED&&(a="Approved"),e.status===l.LOAN_STATUS_SENT_BACK&&(a="Sent Back");let r=e.created_at?new Date(e.created_at):new Date;return{id:e.id.toString(),serialNo:e.id,contractNo:e.loan_id,customerName:e.customer?.full_name||"N/A",nic:e.customer?.customer_code||"N/A",loanAmount:Number(e.approved_amount||0),staff:e.staff?.full_name||e.staff?.user_name||"N/A",submittedDate:r.toISOString().split("T")[0],submittedTime:r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),firstApproval:t,firstApprovalDate:e.approve_history?.first?`${e.approve_history.first.name} (${new Date(e.approve_history.first.at).toLocaleDateString()})`:void 0,secondApproval:s>1?"Approved":1===s?"Pending":null,secondApprovalDate:e.approve_history?.second?`${e.approve_history.second.name} (${new Date(e.approve_history.second.at).toLocaleDateString()})`:void 0,status:a,rejectionReason:e.rejection_reason,loanDetails:{purpose:e.loan_step||"N/A",tenure:e.terms,interestRate:Number(e.interest_rate),center:e.center?.center_name||"N/A",group:e.group?.group_name||"N/A",branchManager:e.center?.branch?.manager?.full_name||e.center?.branch?.manager_name||"Branch Manager"},rawLoan:e}},b=(0,t.useCallback)(async()=>{i(!0);try{let e=(await a.loanService.getLoans({per_page:100,status:"all_statuses"})).data.filter(e=>[l.LOAN_STATUS_PENDING_1ST,l.LOAN_STATUS_PENDING_2ND].includes(e.status));s(e.map(g)),d(null)}catch(e){d("Failed to fetch loan approvals"),console.error(e)}finally{i(!1)}},[]);(0,t.useEffect)(()=>{b()},[b]);let f=(0,t.useMemo)(()=>e.filter(e=>{let s=e.contractNo.toLowerCase().includes(o.toLowerCase())||e.customerName.toLowerCase().includes(o.toLowerCase())||e.nic.toLowerCase().includes(o.toLowerCase()),t="all"===m||e.status===m;return s&&t}),[e,o,m]),N=(0,t.useCallback)(async(e,s,t="")=>{try{await a.loanService.approveLoan(e,"approve"===s?"approve":"send_back",t),await b(),u(null)}catch(e){console.error("Approval failed:",e),r.toast.error("Failed to process approval")}},[b]),j=(0,t.useCallback)(async(e,s,t="")=>{try{await a.loanService.approveLoan(e,"approve"===s?"approve":"send_back",t),await b(),u(null)}catch(e){console.error("Approval failed:",e),r.toast.error("Failed to process approval")}},[b]);return{loans:e,isLoading:n,error:c,searchTerm:o,setSearchTerm:x,filterStatus:m,setFilterStatus:p,viewingLoan:h,setViewingLoan:u,filteredLoans:f,handleFirstApproval:N,handleSecondApproval:j,refreshLoans:b}}();return g?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):b?(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:b}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Loan Approval"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Review and approve loan applications"})]})}),(0,s.jsx)(i,{searchTerm:e,onSearchChange:n,filterStatus:c,onStatusChange:d}),(0,s.jsx)(o,{loans:p,onView:m}),x&&(0,s.jsx)(v,{loan:x,onClose:()=>m(null),onFirstApproval:h,onSecondApproval:u})]})}function A(){return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)(w,{})})})}e.s(["default",()=>A],39498)}]);