(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,86536,e=>{"use strict";let t=(0,e.i(75254).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},38533,e=>{"use strict";var t=e.i(64397);e.s(["loanService",0,{getLoans:async e=>{let s=new URLSearchParams;e.search&&s.append("search",e.search),e.status&&s.append("status",e.status),e.page&&s.append("page",e.page.toString()),e.per_page&&s.append("per_page",e.per_page.toString());let a=await fetch(`${t.API_BASE_URL}/loans?${s.toString()}`,{headers:(0,t.getHeaders)()}),r=await a.json();if(!a.ok)throw Error(r.message||"Failed to fetch loans");return r},createLoan:async e=>{let s=await fetch(`${t.API_BASE_URL}/loans`,{method:"POST",headers:(0,t.getHeaders)(),body:JSON.stringify(e)}),a=await s.json();if(!s.ok){let e=a.message||"Failed to submit loan application";if(a.errors){let t=Object.values(a.errors).flat().join(", ");e+=`: ${t}`}throw Error(e)}return a.data},getLoanById:async e=>{let s=await fetch(`${t.API_BASE_URL}/loans/${e}`,{headers:(0,t.getHeaders)()}),a=await s.json();if(!s.ok)throw Error(a.message||"Failed to fetch loan details");return a.data},approveLoan:async(e,s,a)=>{let r=await fetch(`${t.API_BASE_URL}/loans/${e}/approve`,{method:"PATCH",headers:(0,t.getHeaders)(),body:JSON.stringify({action:s,reason:a})}),l=await r.json();if(!r.ok)throw Error(l.message||"Failed to approve loan");return l.data},exportLoans:async()=>{let e=await fetch(`${t.API_BASE_URL}/loans/export`,{headers:(0,t.getHeaders)()});if(!e.ok)throw Error((await e.json().catch(()=>({}))).message||"Failed to export loans");let s=await e.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`loans_export_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r)},importLoans:async e=>{let s=new FormData;s.append("file",e);let a=await fetch(`${t.API_BASE_URL}/loans/import`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:s}),r=await a.json();if(!a.ok)throw Error(r.message||"Failed to import loans");return r}}])},97548,e=>{"use strict";let t=(0,e.i(75254).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["Filter",()=>t],97548)},69074,e=>{"use strict";let t=(0,e.i(75254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>t],69074)},5882,24903,e=>{"use strict";var t=e.i(43476),s=e.i(86536);function a({loans:e,onView:a}){return(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-3",children:(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-4 text-xs font-semibold text-gray-600 uppercase",children:[(0,t.jsx)("div",{className:"col-span-2",children:"Contract No"}),(0,t.jsx)("div",{className:"col-span-2",children:"Customer"}),(0,t.jsx)("div",{className:"col-span-2",children:"Amount"}),(0,t.jsx)("div",{className:"col-span-2",children:"Outstanding"}),(0,t.jsx)("div",{className:"col-span-2",children:"Terms"}),(0,t.jsx)("div",{className:"col-span-1",children:"Status"}),(0,t.jsx)("div",{className:"col-span-1",children:"Actions"})]})}),(0,t.jsx)("div",{className:"divide-y divide-gray-100",children:e.length>0?e.map(e=>(0,t.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-center",children:[(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:e.loan_id}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.agreement_date||"Not set"})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("p",{className:"text-sm text-gray-900",children:e.customer?.full_name||"N/A"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.customer?.customer_code||"N/A"})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["LKR ",Number(e.approved_amount).toLocaleString()]}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[Number(e.interest_rate),"% interest"]})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["LKR ",Number(e.outstanding_amount).toLocaleString()]}),(0,t.jsx)("div",{className:"mt-1 w-full bg-gray-200 rounded-full h-1.5",children:(0,t.jsx)("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:e.approved_amount?`${(Number(e.approved_amount)-Number(e.outstanding_amount))/Number(e.approved_amount)*100}%`:"0%"}})})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-900",children:[e.terms," periods"]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.product?.term_type||"N/A"})]}),(0,t.jsx)("div",{className:"col-span-1",children:(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${(e=>{switch(e){case"Active":case"approved":return"bg-green-100 text-green-700";case"Pending":case"pending_1st":case"pending_2nd":return"bg-yellow-100 text-yellow-700";case"Completed":return"bg-blue-100 text-blue-700";case"Defaulted":return"bg-red-100 text-red-700";case"sent_back":return"bg-amber-100 text-amber-700";default:return"bg-gray-100 text-gray-700"}})(e.status)}`,children:e.status.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}),"sent_back"===e.status&&e.rejection_reason&&(0,t.jsxs)("span",{className:"text-[10px] text-orange-600 font-bold max-w-[100px] truncate",title:e.rejection_reason,children:['"',e.rejection_reason,'"']})]})}),(0,t.jsx)("div",{className:"col-span-1",children:(0,t.jsx)("button",{onClick:()=>a(e),className:"p-1.5 hover:bg-blue-50 rounded text-blue-600",children:(0,t.jsx)(s.Eye,{className:"w-4 h-4"})})})]})},e.id)):(0,t.jsx)("div",{className:"px-6 py-10 text-center text-gray-500 italic",children:"No loans found matching your criteria."})})]})}e.s(["LoanTable",()=>a],5882);var r=e.i(42365);function l({loan:e,onClose:s}){let a=r.authService.hasRole("field_officer")||r.authService.hasRole("staff");return(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),(0,t.jsxs)("div",{className:"relative w-full max-w-2xl bg-white rounded-3xl shadow-2xl border border-gray-100 overflow-hidden animate-in zoom-in-95 duration-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 bg-gray-50/50 border-b border-gray-100",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-black text-gray-900",children:"Loan Portfolio Details"}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 font-medium",children:["Contract Ref: ",(0,t.jsx)("span",{className:"text-blue-600 font-bold",children:e.loan_id})]})]}),(0,t.jsx)("button",{onClick:s,className:"w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-gray-200 text-gray-400 hover:text-red-500 transition-all shadow-sm",children:"Ã—"})]}),(0,t.jsxs)("div",{className:"p-8 space-y-8 max-h-[80vh] overflow-y-auto",children:["sent_back"===e.status&&e.rejection_reason&&(0,t.jsxs)("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-2xl p-6 flex items-start gap-4 shadow-sm shadow-orange-50",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center text-orange-600 shrink-0 border border-orange-200",children:(0,t.jsx)("span",{className:"font-bold text-lg",children:"!"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-black text-orange-900 text-sm uppercase tracking-wider",children:"Modification Required"}),(0,t.jsxs)("p",{className:"text-sm font-medium text-orange-800 mt-1 leading-relaxed italic",children:['"',e.rejection_reason,'"']})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-6",children:[(0,t.jsx)(n,{label:"Customer",value:e.customer?.full_name,subValue:e.customer?.customer_code}),(0,t.jsx)(n,{label:"Loan Amount",value:`LKR ${Number(e.approved_amount).toLocaleString()}`}),(0,t.jsx)(n,{label:"Outstanding",value:`LKR ${Number(e.outstanding_amount).toLocaleString()}`}),(0,t.jsx)(n,{label:"Interest Rate",value:`${Number(e.interest_rate)}%`}),(0,t.jsx)(n,{label:"Tenure / Term",value:`${e.terms} periods (${e.product?.term_type})`}),(0,t.jsx)(n,{label:"Current Status",value:(0,t.jsx)("span",{className:`inline-flex items-center px-3 py-1 rounded-lg text-xs font-black uppercase tracking-wider ${(e=>{switch(e){case"Active":return"bg-green-100 text-green-700";case"Pending":return"bg-yellow-100 text-yellow-700";case"Completed":return"bg-blue-100 text-blue-700";case"Defaulted":return"bg-red-100 text-red-700";case"sent_back":return"bg-orange-100 text-orange-700";default:return"bg-gray-100 text-gray-700"}})(e.status)}`,children:e.status.replace("_"," ")})}),(0,t.jsx)(n,{label:"Disbursement Date",value:e.agreement_date||"Awaiting Approval"}),(0,t.jsx)(n,{label:"Maturity Date",value:e.end_term||"Awaiting Approval"})]})]}),a&&("sent_back"===e.status||"pending_1st"===e.status||"pending_2nd"===e.status)&&(0,t.jsx)("div",{className:"p-6 bg-gray-50 border-t border-gray-100 flex justify-end",children:(0,t.jsx)("button",{onClick:()=>window.location.href=`/loans/create?edit=${e.id}`,className:"bg-blue-600 text-white px-8 py-3 rounded-2xl font-black text-sm hover:bg-blue-700 transition-all shadow-xl shadow-blue-100 transform hover:-translate-y-1 active:scale-95",children:"sent_back"===e.status?"Modify & Resubmit Application":"Modify Application"})})]})]})}function n({label:e,value:s,subValue:a}){return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:e}),(0,t.jsx)("div",{className:"text-sm font-bold text-gray-900",children:s}),a&&(0,t.jsx)("p",{className:"text-xs text-gray-500 font-medium",children:a})]})}e.s(["LoanDetailModal",()=>l],24903)},4774,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(55436),r=e.i(97548),l=e.i(40160),n=e.i(69074),o=e.i(38533),i=e.i(42365),d=e.i(78583),c=e.i(25652),x=e.i(12426),m=e.i(63209);function u({stats:e}){return(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-5 hover:shadow-md transition-shadow",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(d.FileText,{className:"w-5 h-5 text-blue-600"})})}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Total Loans"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.total_count})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-5 hover:shadow-md transition-shadow",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(c.TrendingUp,{className:"w-5 h-5 text-green-600"})}),(0,t.jsxs)("span",{className:"text-xs font-medium text-gray-600",children:[e.total_count>0?(e.active_count/e.total_count*100).toFixed(0):0,"%"]})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Approved Loans"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.active_count})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-5 hover:shadow-md transition-shadow",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(x.DollarSign,{className:"w-5 h-5 text-purple-600"})})}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Total Disbursed"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["LKR ",(Number(e.total_disbursed)/1e3).toFixed(0),"K"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-5 hover:shadow-md transition-shadow",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(m.AlertCircle,{className:"w-5 h-5 text-orange-600"})})}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Outstanding"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["LKR ",(Number(e.total_outstanding)/1e3).toFixed(0),"K"]})]})]})}var g=e.i(5882),h=e.i(24903),p=e.i(18566),b=e.i(70319);function f(){let e=(0,p.useSearchParams)().get("status"),[d,c]=(0,s.useState)([]),[x,m]=(0,s.useState)({total_count:0,active_count:0,total_disbursed:0,total_outstanding:0}),[f,j]=(0,s.useState)(!0),[y,v]=(0,s.useState)(""),[N,w]=(0,s.useState)(e||"All"),[_,S]=(0,s.useState)(1),[k,L]=(0,s.useState)(1),[A,C]=(0,s.useState)(0),[R,$]=(0,s.useState)(null),[P,E]=(0,s.useState)(!1),T=(0,s.useRef)(null);(0,s.useEffect)(()=>{e&&(w(e),S(1))},[e]);let F=(0,s.useCallback)(async()=>{try{j(!0);let e=await o.loanService.getLoans({search:y,status:N,page:_});c(e.data),m(e.meta.stats),L(e.meta.last_page),C(e.meta.total)}catch(e){b.toast.error("Failed to load loans"),console.error(e)}finally{j(!1)}},[y,N,_]);(0,s.useEffect)(()=>{let e=setTimeout(()=>{F()},300);return()=>clearTimeout(e)},[F]);let U=async()=>{try{await o.loanService.exportLoans(),b.toast.success("Loans exported successfully")}catch(e){b.toast.error(e.message||"Failed to export loans")}},D=async e=>{let t=e.target.files?.[0];if(t){if(!t.name.endsWith(".csv"))return void b.toast.error("Please upload a valid CSV file");E(!0);try{await o.loanService.importLoans(t),b.toast.success("Loans imported successfully"),F()}catch(e){b.toast.error(e.message||"Failed to import loans")}finally{E(!1),T.current&&(T.current.value="")}}};return(0,t.jsxs)("div",{className:"p-6 max-w-7xl mx-auto space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Loan List"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"View and manage all loan accounts"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[(0,t.jsx)("input",{type:"file",ref:T,onChange:D,accept:".csv",className:"hidden"}),i.authService.hasPermission("loans.view")&&(0,t.jsxs)("button",{onClick:()=>T.current?.click(),disabled:P,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 bg-white border border-gray-200 text-gray-700 px-4 py-2.5 rounded-xl hover:bg-gray-50 transition-all shadow-sm font-medium text-sm disabled:opacity-50",children:[(0,t.jsx)(n.Upload,{className:"w-4 h-4 text-gray-500"}),(0,t.jsx)("span",{children:P?"Importing...":"Import CSV"})]}),i.authService.hasPermission("loans.view")&&(0,t.jsxs)("button",{onClick:U,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 bg-white border border-gray-200 text-gray-700 px-4 py-2.5 rounded-xl hover:bg-gray-50 transition-all shadow-sm font-medium text-sm",children:[(0,t.jsx)(l.Download,{className:"w-4 h-4 text-gray-500"}),(0,t.jsx)("span",{children:"Export CSV"})]})]})]}),(0,t.jsx)(u,{stats:x}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-4 shadow-sm flex flex-col md:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)(a.Search,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),(0,t.jsx)("input",{type:"text",placeholder:"Search by contract no, customer name or code...",value:y,onChange:e=>{v(e.target.value),S(1)},className:"w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-sm"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-[200px]",children:[(0,t.jsx)(r.Filter,{className:"w-4 h-4 text-gray-400"}),(0,t.jsxs)("select",{value:N,onChange:e=>{w(e.target.value),S(1)},className:"w-full px-3 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 text-sm bg-white",children:[(0,t.jsx)("option",{value:"All",children:"All Portfolio"}),(0,t.jsx)("option",{value:"approved",children:"Approved"}),(0,t.jsx)("option",{value:"Defaulted",children:"Defaulted"}),(0,t.jsx)("option",{value:"sent_back",children:"Sent Back / Rejected"})]})]})]}),f?(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-12 flex flex-col items-center justify-center space-y-4",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm font-medium",children:"Loading loans..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.LoanTable,{loans:d,onView:$}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 pt-2",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-500 font-medium",children:["Showing ",(0,t.jsx)("span",{className:"text-gray-900",children:d.length})," of ",(0,t.jsx)("span",{className:"text-gray-900",children:A})," loans"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>S(e=>Math.max(1,e-1)),disabled:1===_,className:"px-4 py-2 border border-gray-200 rounded-xl text-sm font-semibold text-gray-700 hover:bg-white disabled:opacity-40 disabled:hover:bg-transparent transition-all shadow-sm",children:"Previous"}),(0,t.jsx)("div",{className:"flex items-center gap-1",children:[...Array(k)].map((e,s)=>(0,t.jsx)("button",{onClick:()=>S(s+1),className:`w-10 h-10 rounded-xl text-sm font-bold transition-all ${_===s+1?"bg-blue-600 text-white shadow-md shadow-blue-200":"text-gray-600 hover:bg-gray-100"}`,children:s+1},s+1))}),(0,t.jsx)("button",{onClick:()=>S(e=>Math.min(k,e+1)),disabled:_===k,className:"px-4 py-2 border border-gray-200 rounded-xl text-sm font-semibold text-gray-700 hover:bg-white disabled:opacity-40 disabled:hover:bg-transparent transition-all shadow-sm",children:"Next"})]})]})]}),R&&(0,t.jsx)(h.LoanDetailModal,{loan:R,onClose:()=>$(null)})]})}e.s(["default",()=>f],4774)}]);