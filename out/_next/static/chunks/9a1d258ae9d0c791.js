(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,86536,e=>{"use strict";let a=(0,e.i(75254).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>a],86536)},38533,e=>{"use strict";var a=e.i(64397);e.s(["loanService",0,{getLoans:async e=>{let t=new URLSearchParams;e.search&&t.append("search",e.search),e.status&&t.append("status",e.status),e.page&&t.append("page",e.page.toString()),e.per_page&&t.append("per_page",e.per_page.toString());let s=await fetch(`${a.API_BASE_URL}/loans?${t.toString()}`,{headers:(0,a.getHeaders)()}),r=await s.json();if(!s.ok)throw Error(r.message||"Failed to fetch loans");return r},createLoan:async e=>{let t=await fetch(`${a.API_BASE_URL}/loans`,{method:"POST",headers:(0,a.getHeaders)(),body:JSON.stringify(e)}),s=await t.json();if(!t.ok){let e=s.message||"Failed to submit loan application";if(s.errors){let a=Object.values(s.errors).flat().join(", ");e+=`: ${a}`}throw Error(e)}return s.data},getLoanById:async e=>{let t=await fetch(`${a.API_BASE_URL}/loans/${e}`,{headers:(0,a.getHeaders)()}),s=await t.json();if(!t.ok)throw Error(s.message||"Failed to fetch loan details");return s.data},approveLoan:async(e,t,s)=>{let r=await fetch(`${a.API_BASE_URL}/loans/${e}/approve`,{method:"PATCH",headers:(0,a.getHeaders)(),body:JSON.stringify({action:t,reason:s})}),n=await r.json();if(!r.ok)throw Error(n.message||"Failed to approve loan");return n.data},exportLoans:async()=>{let e=await fetch(`${a.API_BASE_URL}/loans/export`,{headers:(0,a.getHeaders)()});if(!e.ok)throw Error((await e.json().catch(()=>({}))).message||"Failed to export loans");let t=await e.blob(),s=window.URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=`loans_export_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r)},importLoans:async e=>{let t=new FormData;t.append("file",e);let s=await fetch(`${a.API_BASE_URL}/loans/import`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:t}),r=await s.json();if(!s.ok)throw Error(r.message||"Failed to import loans");return r}}])},5882,24903,e=>{"use strict";var a=e.i(43476),t=e.i(86536);function s({loans:e,onView:s}){return(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 text-xs font-semibold text-gray-600 uppercase",children:[(0,a.jsx)("div",{className:"col-span-2",children:"Contract No"}),(0,a.jsx)("div",{className:"col-span-2",children:"Customer"}),(0,a.jsx)("div",{className:"col-span-2",children:"Amount"}),(0,a.jsx)("div",{className:"col-span-2",children:"Outstanding"}),(0,a.jsx)("div",{className:"col-span-2",children:"Terms"}),(0,a.jsx)("div",{className:"col-span-1",children:"Status"}),(0,a.jsx)("div",{className:"col-span-1",children:"Actions"})]})}),(0,a.jsx)("div",{className:"divide-y divide-gray-100",children:e.length>0?e.map(e=>(0,a.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-center",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.loan_id}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.agreement_date||"Not set"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-900",children:e.customer?.full_name||"N/A"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.customer?.customer_code||"N/A"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["LKR ",Number(e.approved_amount).toLocaleString()]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[Number(e.interest_rate),"% interest"]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["LKR ",Number(e.outstanding_amount).toLocaleString()]}),(0,a.jsx)("div",{className:"mt-1 w-full bg-gray-200 rounded-full h-1.5",children:(0,a.jsx)("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:e.approved_amount?`${(Number(e.approved_amount)-Number(e.outstanding_amount))/Number(e.approved_amount)*100}%`:"0%"}})})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-900",children:[e.terms," periods"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.product?.term_type||"N/A"})]}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${(e=>{switch(e){case"Active":case"approved":return"bg-green-100 text-green-700";case"Pending":case"pending_1st":case"pending_2nd":return"bg-yellow-100 text-yellow-700";case"Completed":return"bg-blue-100 text-blue-700";case"Defaulted":return"bg-red-100 text-red-700";case"sent_back":return"bg-amber-100 text-amber-700";default:return"bg-gray-100 text-gray-700"}})(e.status)}`,children:e.status.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}),"sent_back"===e.status&&e.rejection_reason&&(0,a.jsxs)("span",{className:"text-[10px] text-orange-600 font-bold max-w-[100px] truncate",title:e.rejection_reason,children:['"',e.rejection_reason,'"']})]})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)("button",{onClick:()=>s(e),className:"p-1.5 hover:bg-blue-50 rounded text-blue-600",children:(0,a.jsx)(t.Eye,{className:"w-4 h-4"})})})]})},e.id)):(0,a.jsx)("div",{className:"px-6 py-10 text-center text-gray-500 italic",children:"No loans found matching your criteria."})})]})}e.s(["LoanTable",()=>s],5882);var r=e.i(42365);function n({loan:e,onClose:t}){let s=r.authService.hasRole("field_officer")||r.authService.hasRole("staff");return(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:t}),(0,a.jsxs)("div",{className:"relative w-full max-w-2xl bg-white rounded-3xl shadow-2xl border border-gray-100 overflow-hidden animate-in zoom-in-95 duration-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 bg-gray-50/50 border-b border-gray-100",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-black text-gray-900",children:"Loan Portfolio Details"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 font-medium",children:["Contract Ref: ",(0,a.jsx)("span",{className:"text-blue-600 font-bold",children:e.loan_id})]})]}),(0,a.jsx)("button",{onClick:t,className:"w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-gray-200 text-gray-400 hover:text-red-500 transition-all shadow-sm",children:"Ã—"})]}),(0,a.jsxs)("div",{className:"p-8 space-y-8 max-h-[80vh] overflow-y-auto",children:["sent_back"===e.status&&e.rejection_reason&&(0,a.jsxs)("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-2xl p-6 flex items-start gap-4 shadow-sm shadow-orange-50",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center text-orange-600 shrink-0 border border-orange-200",children:(0,a.jsx)("span",{className:"font-bold text-lg",children:"!"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-black text-orange-900 text-sm uppercase tracking-wider",children:"Modification Required"}),(0,a.jsxs)("p",{className:"text-sm font-medium text-orange-800 mt-1 leading-relaxed italic",children:['"',e.rejection_reason,'"']})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-6",children:[(0,a.jsx)(l,{label:"Customer",value:e.customer?.full_name,subValue:e.customer?.customer_code}),(0,a.jsx)(l,{label:"Loan Amount",value:`LKR ${Number(e.approved_amount).toLocaleString()}`}),(0,a.jsx)(l,{label:"Outstanding",value:`LKR ${Number(e.outstanding_amount).toLocaleString()}`}),(0,a.jsx)(l,{label:"Interest Rate",value:`${Number(e.interest_rate)}%`}),(0,a.jsx)(l,{label:"Tenure / Term",value:`${e.terms} periods (${e.product?.term_type})`}),(0,a.jsx)(l,{label:"Current Status",value:(0,a.jsx)("span",{className:`inline-flex items-center px-3 py-1 rounded-lg text-xs font-black uppercase tracking-wider ${(e=>{switch(e){case"Active":return"bg-green-100 text-green-700";case"Pending":return"bg-yellow-100 text-yellow-700";case"Completed":return"bg-blue-100 text-blue-700";case"Defaulted":return"bg-red-100 text-red-700";case"sent_back":return"bg-orange-100 text-orange-700";default:return"bg-gray-100 text-gray-700"}})(e.status)}`,children:e.status.replace("_"," ")})}),(0,a.jsx)(l,{label:"Disbursement Date",value:e.agreement_date||"Awaiting Approval"}),(0,a.jsx)(l,{label:"Maturity Date",value:e.end_term||"Awaiting Approval"})]})]}),s&&("sent_back"===e.status||"pending_1st"===e.status||"pending_2nd"===e.status)&&(0,a.jsx)("div",{className:"p-6 bg-gray-50 border-t border-gray-100 flex justify-end",children:(0,a.jsx)("button",{onClick:()=>window.location.href=`/loans/create?edit=${e.id}`,className:"bg-blue-600 text-white px-8 py-3 rounded-2xl font-black text-sm hover:bg-blue-700 transition-all shadow-xl shadow-blue-100 transform hover:-translate-y-1 active:scale-95",children:"sent_back"===e.status?"Modify & Resubmit Application":"Modify Application"})})]})]})}function l({label:e,value:t,subValue:s}){return(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:e}),(0,a.jsx)("div",{className:"text-sm font-bold text-gray-900",children:t}),s&&(0,a.jsx)("p",{className:"text-xs text-gray-500 font-medium",children:s})]})}e.s(["LoanDetailModal",()=>n],24903)},37163,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(63209);let r=(0,e.i(75254).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var n=e.i(38533),l=e.i(5882),i=e.i(24903),o=e.i(70319);function c(){let[e,c]=(0,t.useState)([]),[d,x]=(0,t.useState)(!0),[m,u]=(0,t.useState)(null),h=(0,t.useCallback)(async()=>{try{x(!0);let e=await n.loanService.getLoans({status:"sent_back",per_page:100});c(e.data)}catch(e){o.toast.error("Failed to load sent back loans"),console.error(e)}finally{x(!1)}},[]);return(0,t.useEffect)(()=>{h()},[h]),(0,a.jsxs)("div",{className:"p-8 space-y-8 animate-in fade-in duration-500",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-black text-gray-900 tracking-tight flex items-center gap-3 font-outfit",children:["Sent Back Applications",(0,a.jsx)("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-orange-100 text-orange-600 text-sm border border-orange-200",children:e.length})]}),(0,a.jsx)("p",{className:"text-gray-500 font-medium mt-1",children:"Review and modify applications that were returned for correction."})]}),(0,a.jsxs)("button",{onClick:h,className:"flex items-center gap-2 px-5 py-2.5 bg-white border border-gray-200 text-gray-700 font-bold rounded-xl hover:bg-gray-50 transition-all shadow-sm active:scale-95",children:[(0,a.jsx)(r,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Refresh List"]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 border-2 border-orange-100 rounded-2xl p-6 flex items-start gap-5 shadow-sm",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-orange-600 shadow-sm shrink-0 border border-orange-100",children:(0,a.jsx)(s.AlertCircle,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"font-black text-orange-900 text-sm uppercase tracking-wider",children:"Instructions for Modification"}),(0,a.jsxs)("p",{className:"text-sm font-medium text-orange-800 leading-relaxed",children:["Loans listed here have been reviewed by a Manager or Admin and require specific updates. Click the view button to see the rejection reason, then click ",(0,a.jsx)("span",{className:"font-black",children:"Modify & Resubmit"})," to update the application details."]})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-[2rem] border border-gray-100 shadow-xl shadow-gray-200/50 overflow-hidden",children:d?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 gap-4",children:[(0,a.jsx)("div",{className:"w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("p",{className:"text-gray-400 font-bold text-sm",children:"Fetching corrections..."})]}):e.length>0?(0,a.jsx)(l.LoanTable,{loans:e,onView:e=>u(e)}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-80 gap-6",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-green-50 rounded-3xl flex items-center justify-center text-green-500 border border-green-100",children:(0,a.jsx)(s.AlertCircle,{className:"w-10 h-10"})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-xl font-black text-gray-900",children:"All Clear!"}),(0,a.jsx)("p",{className:"text-gray-400 font-medium mt-1",children:"You don't have any loan applications that need modification."})]})]})}),m&&(0,a.jsx)(i.LoanDetailModal,{loan:m,onClose:()=>u(null)})]})}e.s(["default",()=>c],37163)}]);