(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,34806,e=>{"use strict";var r=e.i(43476),a=e.i(71645),s=e.i(7233),t=e.i(55436),l=e.i(40160),i=e.i(97548),n=e.i(69074),o=e.i(25859),d=e.i(61911),c=e.i(82293),x=e.i(98919),m=e.i(75254);let u=(0,m.default)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);function g({stats:e,pendingRequestsCount:a=0}){let{totalCustomers:s,activeCustomers:t,customersWithLoans:l,newThisMonth:i}=e;return(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:(0,r.jsx)(d.Users,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),(0,r.jsxs)("span",{className:"text-xs font-medium text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 px-2 py-1 rounded",children:["+",i," this month"]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Total Customers"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:(0,r.jsx)(c.UserCheck,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),(0,r.jsxs)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:[s>0?(t/s*100).toFixed(0):0,"%"]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Active Customers"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:t})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center",children:(0,r.jsx)(x.Shield,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),(0,r.jsxs)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:[s>0?(l/s*100).toFixed(0):0,"%"]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"With Active Loans"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:l})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg flex items-center justify-center",children:(0,r.jsx)(u,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),a>0&&(0,r.jsx)("span",{className:"text-xs font-medium text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/30 px-2 py-1 rounded",children:"Action needed"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Pending Requests"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a})]})]})}var b=e.i(27612),h=e.i(43432),p=e.i(63488),y=e.i(42365);function f({customers:e,onEdit:a,onDelete:s,onStatusChange:t,onViewDetails:l,selectedCustomer:i}){return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700 px-6 py-3",children:(0,r.jsxs)("div",{className:"grid grid-cols-12 gap-4 text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase",children:[(0,r.jsx)("div",{className:"col-span-4",children:"Customer"}),(0,r.jsx)("div",{className:"col-span-3",children:"Contact"}),(0,r.jsx)("div",{className:"col-span-3",children:"Branch/Center"}),(0,r.jsx)("div",{className:"col-span-1",children:"Status"}),(0,r.jsx)("div",{className:"col-span-1",children:"Action"})]})}),(0,r.jsx)("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:e.map(e=>(0,r.jsx)("div",{onClick:()=>l(e),className:`px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors ${i?.id===e.id?"bg-blue-50 dark:bg-blue-900/20":""}`,children:(0,r.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-center",children:[(0,r.jsxs)("div",{className:"col-span-4 flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,r.jsx)("span",{className:"text-white text-sm font-semibold",children:e.full_name.charAt(0)})}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:e.full_name})}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.customer_code})]})]}),(0,r.jsxs)("div",{className:"col-span-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5 text-sm text-gray-900 dark:text-gray-100 mb-1",children:[(0,r.jsx)(h.Phone,{className:"w-3.5 h-3.5 text-gray-400"}),(0,r.jsx)("span",{children:e.mobile_no_1})]}),e.business_email&&(0,r.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 dark:text-gray-400 truncate",children:[(0,r.jsx)(p.Mail,{className:"w-3 h-3 text-gray-400"}),(0,r.jsx)("span",{className:"truncate",children:e.business_email})]})]}),(0,r.jsxs)("div",{className:"col-span-3 min-w-0",children:[(0,r.jsxs)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:[e.branch?.branch_name||e.branch_name||"No Branch",e.branch_id&&(0,r.jsxs)("span",{className:"text-[10px] text-gray-400 font-normal ml-1",children:["#",e.branch_id]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400 truncate",children:[(0,r.jsxs)("span",{className:"truncate",children:[e.center?.center_name||e.center_name||"No Center",e.center_id&&(0,r.jsxs)("span",{className:"text-[10px] text-gray-400 font-normal ml-0.5",children:["#",e.center_id]})]}),(e.group?.group_name||e.group_name||e.grp_id)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-gray-300 dark:text-gray-600",children:"•"}),(0,r.jsxs)("span",{className:"truncate",children:[e.group?.group_name||e.group_name||"No Group",e.grp_id&&(0,r.jsxs)("span",{className:"text-[10px] text-gray-400 font-normal ml-0.5",children:["#",e.grp_id]})]})]})]})]}),(0,r.jsxs)("div",{className:"col-span-1",children:[(0,r.jsx)("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium capitalize ${"active"===e.status?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"blocked"===e.status?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300"}`,children:e.status||"Active"}),(e.active_loans_count,(0,r.jsxs)("p",{className:"text-[10px] font-medium text-orange-600 dark:text-orange-400 mt-1",children:[e.active_loans_count??0," loan(s)"]}))]}),(0,r.jsxs)("div",{className:"col-span-1 flex items-center gap-2",children:[y.authService.hasPermission("customers.edit")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:r=>{r.stopPropagation();let a="blocked"===e.status?"active":"blocked";t(e,a)},className:`p-1 rounded transition-colors ${"blocked"===e.status?"text-green-600 hover:bg-green-50 dark:text-green-400 dark:hover:bg-green-900/30":"text-orange-600 hover:bg-orange-50 dark:text-orange-400 dark:hover:bg-orange-900/30"}`,title:"blocked"===e.status?"Enable Customer":"Disable Customer",children:(0,r.jsx)(x.Shield,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:r=>{r.stopPropagation(),a(e)},className:"text-sm font-medium text-blue-600 dark:text-blue-400 hover:underline",title:"Edit",children:"Edit"})]}),y.authService.hasPermission("customers.delete")&&(0,r.jsx)("button",{onClick:r=>{r.stopPropagation(),s(e.id)},className:"p-1 hover:bg-red-50 dark:hover:bg-red-900/30 rounded text-red-600 dark:text-red-400",title:"Delete",children:(0,r.jsx)(b.Trash2,{className:"w-4 h-4"})})]})]})},e.id))}),(0,r.jsx)("div",{className:"bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700 px-6 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",(0,r.jsx)("span",{className:"font-medium",children:e.length})," of ",(0,r.jsx)("span",{className:"font-medium",children:e.length})," customers"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 disabled:opacity-50",children:"Previous"}),(0,r.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white rounded text-sm",children:"1"}),(0,r.jsx)("button",{className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 disabled:opacity-50",children:"Next"})]})]})})]})}var v=e.i(37727),j=e.i(46897),k=e.i(87316),_=e.i(84614),N=e.i(63727),w=e.i(42920);let C=(0,m.default)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);var S=e.i(12426),q=e.i(81418),P=e.i(95468),A=e.i(86311);function M({customer:e,onClose:a}){if(!e)return null;let s=({label:e,value:a,icon:s,color:t="blue"})=>(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:`p-2 bg-${t}-50 dark:bg-${t}-900/30 rounded-lg shrink-0`,children:(0,r.jsx)(s,{className:`w-4 h-4 text-${t}-600 dark:text-${t}-400`})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("p",{className:"text-[10px] uppercase font-bold text-gray-400 dark:text-gray-500 tracking-wider blur-[0.2px]",children:e}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:a||"-"})]})]}),t=({title:e,children:a,icon:s})=>(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100 dark:border-gray-700/50",children:[s&&(0,r.jsx)(s,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("h4",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest",children:e})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a})]});return(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-[110] p-4 animate-in fade-in duration-200",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-3xl max-w-5xl w-full shadow-2xl border border-gray-200 dark:border-gray-700/50 flex flex-col h-full max-h-[92vh] overflow-hidden transform scale-100 transition-transform",children:[(0,r.jsxs)("div",{className:"p-6 md:p-8 border-b border-gray-100 dark:border-gray-700/50 flex items-center justify-between bg-white dark:bg-gray-800 sticky top-0 z-10",children:[(0,r.jsxs)("div",{className:"flex items-center gap-5",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-xl shadow-blue-500/20 text-white text-2xl font-black",children:e.full_name?.charAt(0)||"C"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-black text-gray-900 dark:text-gray-100 tracking-tight",children:e.full_name}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsx)("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest ${"active"===e.status?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:e.status||"Active"}),(0,r.jsxs)("span",{className:"text-xs text-gray-400 dark:text-gray-500 font-bold uppercase tracking-tighter ml-2",children:["ID: ",e.customer_code]})]})]})]}),(0,r.jsx)("button",{onClick:a,className:"p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-2xl transition-all text-gray-500",children:(0,r.jsx)(v.X,{size:24})})]}),(0,r.jsxs)("div",{className:"flex-1 p-8 md:p-10 space-y-12 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700",children:[(0,r.jsxs)(t,{title:"Personal Profile",icon:_.User,children:[(0,r.jsx)(s,{label:"Identity (NIC)",value:e.customer_code,icon:q.ShieldCheck,color:"blue"}),(0,r.jsx)(s,{label:"Date of Birth",value:e.date_of_birth?new Date(e.date_of_birth).toLocaleDateString(void 0,{dateStyle:"long"}):"-",icon:k.Calendar,color:"purple"}),(0,r.jsx)(s,{label:"Gender",value:e.gender,icon:_.User,color:"pink"}),(0,r.jsx)(s,{label:"Civil Status",value:e.civil_status,icon:C,color:"red"}),(0,r.jsx)(s,{label:"Religion",value:e.religion,icon:w.Building,color:"orange"}),(0,r.jsx)(s,{label:"Spouse Name",value:e.spouse_name,icon:d.Users,color:"indigo"}),(0,r.jsx)(s,{label:"Initials",value:e.initials,icon:_.User,color:"slate"}),(0,r.jsx)(s,{label:"First Name",value:e.first_name,icon:_.User,color:"blue"}),(0,r.jsx)(s,{label:"Last Name",value:e.last_name,icon:_.User,color:"blue"})]}),(0,r.jsxs)(t,{title:"Contact Channels",icon:h.Phone,children:[(0,r.jsx)(s,{label:"Primary Mobile",value:e.mobile_no_1,icon:h.Phone,color:"green"}),(0,r.jsx)(s,{label:"Secondary Mobile",value:e.mobile_no_2,icon:h.Phone,color:"emerald"}),(0,r.jsx)(s,{label:"CCL Mobile",value:e.ccl_mobile_no,icon:A.MessageSquare,color:"teal"}),(0,r.jsx)(s,{label:"Email",value:e.business_email,icon:p.Mail,color:"purple"}),(0,r.jsx)(s,{label:"Fixed Line",value:e.telephone,icon:h.Phone,color:"blue"})]}),(0,r.jsx)(t,{title:"Residency & Address",icon:j.MapPin,children:(0,r.jsxs)("div",{className:"md:col-span-3 bg-gray-50/50 dark:bg-gray-900/30 p-6 rounded-2xl border border-gray-100 dark:border-gray-700/50",children:[(0,r.jsxs)("p",{className:"text-sm font-bold text-gray-900 dark:text-gray-100 leading-relaxed",children:[e.address_line_1,e.address_line_2&&`, ${e.address_line_2}`,e.address_line_3&&`, ${e.address_line_3}`]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 mt-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-widest",children:"City"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:e.city})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-widest",children:"District"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:e.district})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-widest",children:"Province"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:e.province})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-widest",children:"GS Division"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:e.gs_division})]})]})]})}),(0,r.jsxs)(t,{title:"Business & assignment",icon:N.Briefcase,children:[(0,r.jsx)(s,{label:"Branch",value:e.branch?.branch_name||e.branch_name,icon:j.MapPin,color:"blue"}),(0,r.jsx)(s,{label:"Center",value:e.center?.center_name||e.center_name,icon:w.Building,color:"indigo"}),(0,r.jsx)(s,{label:"Group",value:e.group?.group_name||e.group_name,icon:d.Users,color:"purple"}),(0,r.jsx)(s,{label:"Business Name",value:e.business_name,icon:w.Building,color:"amber"}),(0,r.jsx)(s,{label:"Monthly Income",value:e.monthly_income?`Rs. ${Number(e.monthly_income).toLocaleString()}`:"-",icon:S.DollarSign,color:"green"}),(0,r.jsx)(s,{label:"Sector",value:e.sector,icon:N.Briefcase,color:"emerald"}),(0,r.jsx)(s,{label:"Ownership",value:e.ownership_type,icon:w.Building,color:"indigo"}),(0,r.jsx)(s,{label:"Location",value:e.location,icon:j.MapPin,color:"blue"}),(0,r.jsx)(s,{label:"CSU Code",value:e.pcsu_csu_code,icon:w.Building,color:"violet"})]})]}),(0,r.jsx)("div",{className:"p-8 border-t border-gray-100 dark:border-gray-700/50 flex justify-end bg-gray-50/50 dark:bg-gray-900/50 backdrop-blur-xl",children:(0,r.jsxs)("button",{onClick:a,className:"flex items-center gap-3 px-12 py-3.5 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl transition-all font-black text-sm uppercase tracking-widest shadow-2xl shadow-blue-500/25 active:scale-95",children:[(0,r.jsx)(P.CheckCircle2,{size:20}),"Done Viewing"]})})]})})}let D=(0,m.default)("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]]);var F=e.i(64659),$=e.i(70319);let B=({icon:e,title:a})=>(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-6 pb-2 border-b border-gray-100 dark:border-gray-700/50",children:[(0,r.jsx)("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded-xl text-blue-600 dark:text-blue-400",children:(0,r.jsx)(e,{size:18})}),(0,r.jsx)("h3",{className:"text-sm font-bold text-gray-800 dark:text-gray-200 uppercase tracking-widest",children:a})]}),R=({label:e,name:a,type:s="text",placeholder:t,required:l,error:i,icon:n,colSpan:o=1,value:d,onChange:c,readOnly:x})=>(0,r.jsxs)("div",{className:`space-y-1.5 ${2===o?"md:col-span-2":3===o?"md:col-span-3":""}`,children:[(0,r.jsxs)("label",{className:"text-xs font-bold text-gray-600 dark:text-gray-400 uppercase tracking-tight flex items-center gap-1 ml-1",children:[e," ",l&&(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"relative group",children:[n&&(0,r.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-blue-500 transition-colors pointer-events-none",children:(0,r.jsx)(n,{size:14})}),(0,r.jsx)("input",{type:s,name:a,value:d||"",onChange:c,readOnly:x,min:"number"===s?"0":void 0,placeholder:t,className:`w-full ${n?"pl-9":"pl-4"} pr-4 py-2.5 bg-gray-50 dark:bg-gray-900/40 border ${i?"border-red-500 focus:ring-red-500/10":"border-gray-200 dark:border-gray-700/50 focus:ring-blue-500/10"} rounded-xl focus:outline-none focus:ring-4 focus:border-blue-500 transition-all text-sm text-gray-900 dark:text-gray-100 placeholder:text-gray-400 dark:placeholder:text-gray-600 ${x?"cursor-not-allowed opacity-70":""}`})]}),i&&(0,r.jsx)("p",{className:"text-[10px] text-red-500 font-bold ml-1 animate-in fade-in slide-in-from-top-1",children:i})]}),I=({label:e,name:a,options:s,required:t,error:l,icon:i,colSpan:n=1,value:o,onChange:d})=>(0,r.jsxs)("div",{className:`space-y-1.5 ${2===n?"md:col-span-2":3===n?"md:col-span-3":""}`,children:[(0,r.jsxs)("label",{className:"text-xs font-bold text-gray-600 dark:text-gray-400 uppercase tracking-tight flex items-center gap-1 ml-1",children:[e," ",t&&(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"relative group",children:[i&&(0,r.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-blue-500 transition-colors pointer-events-none",children:(0,r.jsx)(i,{size:14})}),(0,r.jsxs)("select",{name:a,value:o||"",onChange:d,className:`w-full ${i?"pl-9":"pl-4"} pr-10 py-2.5 bg-gray-50 dark:bg-gray-900/40 border ${l?"border-red-500 focus:ring-red-500/10":"border-gray-200 dark:border-gray-700/50 focus:ring-blue-500/10"} rounded-xl focus:outline-none focus:ring-4 focus:border-blue-500 transition-all text-sm text-gray-900 dark:text-gray-100 appearance-none cursor-pointer`,children:[(0,r.jsxs)("option",{value:"",children:["Select ",e]}),s?.map(e=>(0,r.jsx)("option",{value:e.value||e,children:e.label||e},e.value||e))]}),(0,r.jsx)(F.ChevronDown,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]}),l&&(0,r.jsx)("p",{className:"text-[10px] text-red-500 font-bold ml-1 animate-in fade-in slide-in-from-top-1",children:l})]});function L({onClose:e,onSubmit:s,initialData:t}){let[l,i]=(0,a.useState)(!1),[n,d]=(0,a.useState)(null),[c,x]=(0,a.useState)([]),[m,u]=(0,a.useState)([]),[g,b]=(0,a.useState)({code_type:"NIC",address_type:"Home Address",country:"Sri Lanka",...t,date_of_birth:t?.date_of_birth?new Date(t.date_of_birth).toISOString().split("T")[0]:""}),[f,S]=(0,a.useState)({}),M=y.authService.hasRole("field_officer"),F=t?.active_loans_count>0,L=!!t,T=t?.is_edit_locked===!1,E=L&&M&&F&&!T,z=t?.edit_request_status==="pending";(0,a.useEffect)(()=>{U()},[]);let U=async()=>{try{let e=await o.customerService.getConstants(),r=y.authService.getCurrentUser(),a=y.authService.hasRole("field_officer");if(e){let s=e.branches||[],l=e.centers||[];if(a&&r){l=e.centers.filter(e=>e.staff_id===r.user_name);let a=[...new Set(l.map(e=>e.branch_id))];s=e.branches.filter(e=>a.includes(e.id)),1!==s.length||g.branch_id||t||(b(e=>({...e,branch_id:s[0].id})),u(l.filter(e=>e.branch_id===s[0].id&&"active"===e.status)))}if(d({...e,branches:s,centers:e.centers}),t?.province&&e.province_districts_map&&x(e.province_districts_map[t.province]||[]),t?.branch_id&&e.centers){let r=a?l:e.centers;u(r.filter(e=>e.branch_id===t.branch_id&&"active"===e.status))}else a&&1===s.length&&u(l.filter(e=>e.branch_id===s[0].id&&"active"===e.status))}}catch(e){console.error("Failed to load constants",e)}},O=e=>{let{name:r,value:a,type:s}=e.target,t=a;if("branch_id"===r||"center_id"===r||"grp_id"===r||"number"===s?t=""===a?void 0:parseInt(a):"checkbox"===s&&(t=e.target.checked),b(e=>({...e,[r]:t})),f[r]&&S(e=>({...e,[r]:""})),"province"===r&&n?.province_districts_map&&(x(n.province_districts_map[a]||[]),b(e=>({...e,district:""}))),"branch_id"===r){let e=parseInt(a),r=y.authService.getCurrentUser(),s=y.authService.hasRole("field_officer");if(n?.centers){let a=n.centers;s&&r&&(a=n.centers.filter(e=>e.staff_id===r.user_name)),u(a.filter(r=>r.branch_id===e&&"active"===r.status))}else u([]);b(r=>({...r,branch_id:e,center_id:void 0}))}},X=async r=>{if(r.preventDefault(),!(()=>{let e={};if(g.branch_id||(e.branch_id="Branch is required"),g.center_id||(e.center_id="Center is required"),g.title||(e.title="Title is required"),g.full_name?.trim()||(e.full_name="Full name is required"),g.initials?.trim()||(e.initials="Initials are required"),g.first_name?.trim()||(e.first_name="First name is required"),g.last_name?.trim()||(e.last_name="Last name is required"),g.customer_code?.trim()){let r=g.customer_code.trim();if(/^([0-9]{9}[x|X|v|V]|[0-9]{12})$/.test(r)){let a=(e=>{let r=e.toUpperCase().trim(),a=0;if(/^(\d{9})[VX]$/.test(r))a=parseInt(r.substring(2,5));else{if(!/^(\d{12})$/.test(r))return null;a=parseInt(r.substring(4,7))}return a>500?"Female":"Male"})(r);a&&g.gender&&a!==g.gender&&(e.gender=`Matches ${a} NIC`)}else e.customer_code="Invalid NIC format"}else e.customer_code="NIC is required";if(g.date_of_birth){let r,a,s,t,l=(r=new Date(g.date_of_birth),s=(a=new Date).getFullYear()-r.getFullYear(),((t=a.getMonth()-r.getMonth())<0||0===t&&a.getDate()<r.getDate())&&s--,s);l<18&&(e.date_of_birth="Min 18 years"),l>65&&(e.date_of_birth="Max 65 years")}else e.date_of_birth="Required";return g.gender||(e.gender="Gender is required"),g.religion||(e.religion="Religion is required"),g.civil_status||(e.civil_status="Civil status is required"),g.mobile_no_1?.trim()?/^\d{10}$/.test(g.mobile_no_1)||(e.mobile_no_1="10 digits"):e.mobile_no_1="Required",g.mobile_no_2?.trim()&&!/^\d{10}$/.test(g.mobile_no_2)&&(e.mobile_no_2="10 digits"),g.telephone?.trim()&&!/^\d{10}$/.test(g.telephone)&&(e.telephone="10 digits"),g.business_email?.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.business_email)&&(e.business_email="Invalid email"),g.address_line_1?.trim()||(e.address_line_1="Address line 1 is required"),g.city?.trim()||(e.city="City is required"),g.province||(e.province="Province is required"),g.district||(e.district="District is required"),g.gs_division?.trim()||(e.gs_division="GS Division is required"),void 0!==g.family_members_count&&(g.family_members_count<1||g.family_members_count>20)&&(e.family_members_count="1-20 members"),void 0!==g.monthly_income&&g.monthly_income<0&&(e.monthly_income="Invalid income"),void 0!==g.no_of_employees&&g.no_of_employees<0&&(e.no_of_employees="Cannot be negative"),S(e),0===Object.keys(e).length})())return void $.toast.error("Please complete all required fields correctly");i(!0);try{await s(g),$.toast.success(t?"Customer profile updated successfully!":"Customer profile finalized successfully!"),e()}catch(e){$.toast.error(e.message||"Failed to save customer")}finally{i(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-[100] p-4 animate-in fade-in duration-300",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-[2rem] max-w-5xl w-full shadow-2xl border border-gray-200 dark:border-gray-700/50 flex flex-col h-full max-h-[92vh] overflow-hidden transform transition-all",children:[(0,r.jsxs)("div",{className:"p-6 md:p-8 border-b border-gray-100 dark:border-gray-700/50 flex items-center justify-between bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl sticky top-0 z-20",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("h2",{className:"text-2xl font-black text-gray-900 dark:text-white tracking-tight flex items-center gap-3",children:[t?"Edit Profile":"New Customer",!t&&(0,r.jsx)("span",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 text-[10px] rounded-full uppercase tracking-widest font-black ring-1 ring-blue-500/20",children:"Active Draft"}),z&&(0,r.jsx)("span",{className:"px-3 py-1 bg-amber-100 dark:bg-amber-900/40 text-amber-600 dark:text-amber-400 text-[10px] rounded-full uppercase tracking-widest font-black ring-1 ring-amber-500/20",children:"Pending Approval"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 font-bold tracking-wider uppercase opacity-70",children:"Core CRM Portal • Registration Workspace"}),E&&!z&&(0,r.jsx)("p",{className:"text-[10px] text-blue-600 font-bold uppercase tracking-tight bg-blue-50 px-2 py-1 rounded inline-block mt-2",children:"ℹ️ This customer has active loans. Edits will require Manager approval."}),z&&(0,r.jsx)("p",{className:"text-[10px] text-amber-600 font-bold uppercase tracking-tight bg-amber-50 px-2 py-1 rounded inline-block mt-2 font-mono",children:"⚠️ A change request is already pending for this customer."})]}),(0,r.jsx)("button",{onClick:e,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-2xl transition-all text-gray-500 group",children:(0,r.jsx)(v.X,{size:24,className:"group-hover:rotate-90 transition-transform duration-300"})})]}),(0,r.jsxs)("form",{onSubmit:X,className:"flex-1 overflow-y-auto p-6 md:p-10 space-y-12 scroll-smooth scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-800",children:[(0,r.jsxs)("div",{className:"bg-blue-50/30 dark:bg-blue-900/10 p-6 md:p-8 rounded-[1.5rem] border border-blue-100 dark:border-blue-900/30",children:[(0,r.jsx)(B,{icon:w.Building,title:"Product & Location Assignment"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsx)(I,{label:"Branch",name:"branch_id",options:n?.branches?.map(e=>({value:e.id,label:e.branch_name}))||[],required:!0,error:f.branch_id,icon:j.MapPin,value:g.branch_id,onChange:O}),(0,r.jsx)(I,{label:"Center",name:"center_id",options:m?.map(e=>({value:e.id,label:e.center_name}))||[],required:!0,error:f.center_id,icon:w.Building,value:g.center_id,onChange:O}),(0,r.jsx)(R,{label:"Location",name:"location",placeholder:"e.g. Colombo CSU-1",icon:j.MapPin,value:g.location,onChange:O}),(0,r.jsx)(R,{label:"Product Type",name:"product_type",placeholder:"e.g. Micro Finance",value:g.product_type,onChange:O})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(B,{icon:_.User,title:"Personal Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-6",children:[(0,r.jsx)(I,{label:"Title",name:"title",options:["Mr","Mrs","Miss","Ms","Dr","Rev"],required:!0,error:f.title,icon:_.User,value:g.title,onChange:O}),(0,r.jsx)(R,{label:"Full Name",name:"full_name",placeholder:"As per Identity Document",required:!0,error:f.full_name,colSpan:2,value:g.full_name,onChange:O}),(0,r.jsx)(R,{label:"Initials",name:"initials",placeholder:"e.g. W.M.",required:!0,error:f.initials,value:g.initials,onChange:O}),(0,r.jsx)(R,{label:"First Name",name:"first_name",placeholder:"Primary naming",required:!0,error:f.first_name,value:g.first_name,onChange:O}),(0,r.jsx)(R,{label:"Last Name",name:"last_name",placeholder:"Surname",required:!0,error:f.last_name,value:g.last_name,onChange:O}),(0,r.jsx)(R,{label:"NIC Number",name:"customer_code",placeholder:"9 digits + V/X or 12 digits",required:!0,error:f.customer_code,icon:q.ShieldCheck,value:g.customer_code,onChange:O}),(0,r.jsx)(R,{label:"Date of Birth",name:"date_of_birth",type:"date",required:!0,error:f.date_of_birth,icon:k.Calendar,value:g.date_of_birth,onChange:O}),(0,r.jsx)(I,{label:"Gender",name:"gender",options:["Male","Female","Other"],required:!0,error:f.gender,value:g.gender,onChange:O}),(0,r.jsx)(I,{label:"Civil Status",name:"civil_status",options:["Single","Married","Divorced","Widowed"],required:!0,error:f.civil_status,icon:C,value:g.civil_status,onChange:O}),(0,r.jsx)(I,{label:"Religion",name:"religion",options:n?.religions||["Buddhism","Hinduism","Islam","Christianity","Roman Catholic","Other"],required:!0,error:f.religion,value:g.religion,onChange:O}),(0,r.jsx)(R,{label:"Spouse Name",name:"spouse_name",placeholder:"If applicable",colSpan:2,value:g.spouse_name,onChange:O}),(0,r.jsx)(R,{label:"Family Members",name:"family_members_count",type:"number",placeholder:"Count",error:f.family_members_count,value:g.family_members_count,onChange:O}),(0,r.jsx)(R,{label:"Monthly Income (LKR)",name:"monthly_income",type:"number",placeholder:"0.00",icon:D,error:f.monthly_income,value:g.monthly_income,onChange:O})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50/50 dark:bg-gray-900/20 p-6 md:p-8 rounded-[1.5rem] border border-gray-100 dark:border-gray-700/50",children:[(0,r.jsx)(B,{icon:A.MessageSquare,title:"Contact & Address"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,r.jsx)(R,{label:"Primary Mobile",name:"mobile_no_1",placeholder:"077XXXXXXX",icon:h.Phone,required:!0,error:f.mobile_no_1,value:g.mobile_no_1,onChange:O}),(0,r.jsx)(R,{label:"Secondary Mobile",name:"mobile_no_2",placeholder:"Optional",icon:h.Phone,error:f.mobile_no_2,value:g.mobile_no_2,onChange:O}),(0,r.jsx)(R,{label:"Fixed Line",name:"telephone",placeholder:"Optional",icon:h.Phone,error:f.telephone,value:g.telephone,onChange:O}),(0,r.jsx)("div",{className:"md:col-span-3",children:(0,r.jsx)(R,{label:"Address Line 1",name:"address_line_1",placeholder:"House No, Street Name",required:!0,error:f.address_line_1,value:g.address_line_1,onChange:O})}),(0,r.jsx)(R,{label:"Address Line 2",name:"address_line_2",placeholder:"Locality",value:g.address_line_2,onChange:O}),(0,r.jsx)(R,{label:"Address Line 3",name:"address_line_3",placeholder:"Additional info",value:g.address_line_3,onChange:O}),(0,r.jsx)(R,{label:"Grama Sevaka Division",name:"gs_division",placeholder:"GS Name/No",required:!0,error:f.gs_division,value:g.gs_division,onChange:O}),(0,r.jsx)(I,{label:"Province",name:"province",options:n?.provinces||[],required:!0,error:f.province,value:g.province,onChange:O}),(0,r.jsx)(I,{label:"District",name:"district",options:c.length>0?c:n?.districts||[],required:!0,error:f.district,value:g.district,onChange:O}),(0,r.jsx)(I,{label:"City",name:"city",options:n?.cities||[],required:!0,error:f.city,value:g.city,onChange:O}),(0,r.jsx)(R,{label:"Country",name:"country",value:g.country,readOnly:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(B,{icon:N.Briefcase,title:"Business & Employment"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,r.jsx)(R,{label:"Business Name",name:"business_name",placeholder:"If self-employed or company",value:g.business_name,onChange:O}),(0,r.jsx)(I,{label:"Ownership Type",name:"ownership_type",options:n?.ownership_types||[],value:g.ownership_type,onChange:O}),(0,r.jsx)(R,{label:"Register Number",name:"register_number",placeholder:"BR Number",value:g.register_number,onChange:O}),(0,r.jsx)(R,{label:"Business Email",name:"business_email",type:"email",placeholder:"email@business.com",icon:p.Mail,error:f.business_email,value:g.business_email,onChange:O}),(0,r.jsx)(R,{label:"Business Duration",name:"business_duration",placeholder:"e.g. 5 Years",value:g.business_duration,onChange:O}),(0,r.jsx)(R,{label:"Business Place",name:"business_place",placeholder:"City",value:g.business_place,onChange:O}),(0,r.jsx)(R,{label:"Sector",name:"sector",placeholder:"e.g. Agriculture",value:g.sector,onChange:O}),(0,r.jsx)(R,{label:"Sub Sector",name:"sub_sector",placeholder:"e.g. Paddy",value:g.sub_sector,onChange:O}),(0,r.jsx)(R,{label:"No. of Employees",name:"no_of_employees",type:"number",error:f.no_of_employees,value:g.no_of_employees,onChange:O})]})]}),t&&(0,r.jsx)("div",{className:"pt-6 border-t border-gray-100 dark:border-gray-700/50",children:(0,r.jsx)(I,{label:"Customer Status",name:"status",options:n?.statuses||["active","blocked","left"],colSpan:1,value:g.status,onChange:O})})]}),(0,r.jsxs)("div",{className:"p-6 md:p-8 border-t border-gray-100 dark:border-gray-700/50 flex items-center justify-end gap-4 bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl",children:[(0,r.jsx)("button",{onClick:e,disabled:l,className:"px-8 py-3 text-sm font-black text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-2xl transition-all uppercase tracking-widest disabled:opacity-50",children:"Back"}),(0,r.jsx)("button",{onClick:X,disabled:l||z,className:`flex items-center gap-3 px-12 py-3.5 ${z?"bg-gray-400":E?"bg-amber-600 hover:bg-amber-700":"bg-blue-600 hover:bg-blue-700"} text-white rounded-2xl transition-all font-black text-sm uppercase tracking-widest shadow-2xl shadow-blue-500/25 active:scale-[0.98] disabled:opacity-50 disabled:pointer-events-none`,children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-5 h-5 border-4 border-white/30 border-t-white rounded-full animate-spin"}),(0,r.jsx)("span",{children:E?"Submitting...":"Verifying..."})]}):(0,r.jsxs)(r.Fragment,{children:[E?(0,r.jsx)(q.ShieldCheck,{size:20}):(0,r.jsx)(P.CheckCircle2,{size:20}),(0,r.jsx)("span",{children:z?"Request Pending":E?"Submit for Approval":t?"Update Record":"Finalize Profile"})]})})]})]})})}var T=e.i(86536),E=e.i(51737);let z=(0,m.default)("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);var U=e.i(63209),O=e.i(58386);function X({customer:e,onClose:s,onSuccess:t}){let[l,i]=(0,a.useState)(!1),[n,d]=(0,a.useState)([]),[c,x]=(0,a.useState)({requested_center_id:"",reason:""}),[m,u]=(0,a.useState)(null),[g,b]=(0,a.useState)(null);(0,a.useEffect)(()=>{p(),h()},[]);let h=async()=>{try{let r=await o.customerService.checkTransferEligibility(e.id);b(r),r.eligible||u(r.message||"Customer is not eligible for transfer")}catch(e){console.error("Eligibility check failed",e)}},p=async()=>{try{let r=await o.customerService.getConstants();if(r?.centers){let a=r.centers.filter(r=>r.id!==e.center_id&&"active"===r.status);d(a)}}catch(e){console.error("Failed to load centers",e),$.toast.error("Failed to load available centers")}},y=async r=>{if(r.preventDefault(),u(null),!c.requested_center_id)return void u("Please select a new center");if(!c.reason.trim())return void u("Please provide a reason for the transfer");i(!0);try{await O.centerRequestService.createRequest({customer_id:parseInt(e.id),requested_center_id:parseInt(c.requested_center_id),reason:c.reason}),$.toast.success("Center transfer request submitted successfully!"),t(),s()}catch(e){u(e.message||"Failed to submit request"),$.toast.error(e.message||"Failed to submit request")}finally{i(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-[110] p-4 animate-in fade-in duration-300",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-lg w-full shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden transform transition-all",children:[(0,r.jsxs)("div",{className:"p-6 border-b border-gray-100 dark:border-gray-700/50 flex items-center justify-between bg-white/50 dark:bg-gray-800/50 backdrop-blur-xl",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[(0,r.jsx)(w.Building,{className:"w-5 h-5 text-blue-600"}),"Request Center Transfer"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Transfer ",(0,r.jsx)("strong",{children:e.full_name})," to a new center"]})]}),(0,r.jsx)("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors text-gray-500",children:(0,r.jsx)(v.X,{size:20})})]}),(0,r.jsxs)("form",{onSubmit:y,className:"p-6 space-y-6",children:[m&&(0,r.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-4 rounded-xl text-sm flex items-start gap-2",children:[(0,r.jsx)(U.AlertCircle,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),(0,r.jsx)("p",{children:m})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/10 p-4 rounded-xl border border-blue-100 dark:border-blue-900/30",children:[(0,r.jsx)("span",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 uppercase tracking-wider block mb-1",children:"Current Center"}),(0,r.jsx)("div",{className:"font-semibold text-gray-900 dark:text-white",children:e.center?.center_name||e.center_name||"No Center Assigned"}),(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:e.branch?.branch_name||e.branch_name})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"New Center"}),(0,r.jsxs)("select",{value:c.requested_center_id,onChange:e=>x(r=>({...r,requested_center_id:e.target.value})),className:"w-full p-3 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select a center..."}),n.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.center_name," (Branch: ",e.branch_id,")"]},e.id))]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Only active centers are shown."})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Reason for Transfer"}),(0,r.jsx)("textarea",{value:c.reason,onChange:e=>x(r=>({...r,reason:e.target.value})),className:"w-full p-3 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all min-h-[100px]",placeholder:"Please explain why this customer needs to be transferred...",required:!0})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:l||g?.eligible===!1,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl transition-all shadow-lg shadow-blue-500/30 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Submitting..."]}):g?.eligible===!1?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(U.AlertCircle,{size:18}),"Transfer Blocked"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(P.CheckCircle2,{size:18}),"Submit Request"]})})]})]})]})})}function V({customer:e,onClose:s,onEdit:t,onStatusChange:l,onViewFullDetails:i}){let[n,o]=(0,a.useState)(!1),d=(e.active_loans_count??0)>0,c="pending"===e.edit_request_status,x=!1===e.is_edit_locked,m="blocked"===e.status,u=d&&!x;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-md overflow-hidden flex flex-col h-fit",children:[(0,r.jsxs)("div",{className:`${m?"bg-red-600":"bg-blue-600"} p-6 relative transition-colors`,children:[(0,r.jsx)("button",{onClick:s,className:"absolute right-4 top-4 text-white/70 hover:text-white transition-colors",children:(0,r.jsx)(v.X,{className:"w-5 h-5"})}),(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center text-white text-xl font-semibold backdrop-blur-sm",children:e.full_name?.charAt(0)||"C"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-white",children:e.full_name}),m&&(0,r.jsx)("span",{className:"bg-white/20 text-white text-[10px] uppercase font-bold px-2 py-0.5 rounded backdrop-blur-sm",children:"Blocked"})]}),(0,r.jsx)("p",{className:"text-blue-100 text-sm mt-0.5",children:e.customer_code})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("span",{className:"bg-orange-500 text-white text-xs font-semibold px-3 py-1.5 rounded-full flex items-center gap-1.5",children:[(0,r.jsx)("span",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),e.active_loans_count??0," Active Loans"]})})]})]}),(0,r.jsxs)("div",{className:"p-6 flex flex-col gap-6",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-50 dark:bg-gray-700 flex items-center justify-center flex-shrink-0",children:(0,r.jsx)(h.Phone,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Phone Number"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mt-0.5",children:e.mobile_no_1})]})]}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-50 dark:bg-gray-700 flex items-center justify-center flex-shrink-0",children:(0,r.jsx)(p.Mail,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Email Address"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mt-0.5",children:e.business_email||"No email provided"})]})]}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-50 dark:bg-gray-700 flex items-center justify-center flex-shrink-0",children:(0,r.jsx)(j.MapPin,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Center"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mt-0.5",children:e.center?.center_name||e.center_name||"No Center Assigned"})]})]}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-50 dark:bg-gray-700 flex items-center justify-center flex-shrink-0",children:(0,r.jsx)(w.Building,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Branch"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mt-0.5",children:e.branch?.branch_name||e.branch_name||"No Branch Assigned"})]})]})]}),(d||c)&&(0,r.jsxs)("div",{className:`
                            ${c?"bg-amber-50 dark:bg-amber-900/20 border-amber-100":x&&d?"bg-green-50 dark:bg-green-900/20 border-green-100":"bg-orange-50 dark:bg-orange-900/20 border-orange-100"} 
                            border rounded-xl p-4 flex gap-3`,children:[x&&d?(0,r.jsx)(q.ShieldCheck,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):(0,r.jsx)(E.ShieldAlert,{className:`w-5 h-5 ${c?"text-amber-600":"text-orange-600"} flex-shrink-0 mt-0.5`}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:`text-sm font-bold ${c?"text-amber-800":x&&d?"text-green-800":"text-orange-800"}`,children:c?"Pending Approval":x&&d?"Profile Unlocked":"Edit Protection Active"}),(0,r.jsx)("p",{className:`text-xs ${c?"text-amber-600":x&&d?"text-green-600":"text-orange-600"} mt-1 leading-relaxed`,children:c?"A change request is currently under review.":x&&d?"Manager has approved access for direct profile correction.":"Manager approval required for profile changes."})]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-3 mt-2",children:[(0,r.jsxs)("button",{onClick:()=>l(e,m?"active":"blocked"),className:`w-full py-3 rounded-xl text-sm font-semibold transition-all flex items-center justify-center gap-2 shadow-lg ${m?"bg-green-600 hover:bg-green-700 text-white shadow-green-500/20":"bg-red-50 dark:bg-red-900/10 hover:bg-red-100 dark:hover:bg-red-900/20 text-red-600 dark:text-red-400 border border-red-100 dark:border-red-900/30"}`,children:[(0,r.jsx)(E.ShieldAlert,{className:"w-4 h-4"}),m?"Activate Customer":"Disable Customer"]}),(0,r.jsxs)("button",{onClick:()=>t(e),disabled:c,className:`w-full py-3 rounded-xl text-sm font-semibold transition-colors flex items-center justify-center gap-2 shadow-lg 
                                ${c?"bg-gray-400 cursor-not-allowed":x&&d?"bg-green-600 hover:bg-green-700 text-white shadow-green-500/20":u?"bg-orange-600 hover:bg-orange-700 text-white shadow-orange-500/20":"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-500/20"}`,children:[x&&d?(0,r.jsx)(q.ShieldCheck,{className:"w-4 h-4"}):(0,r.jsx)(E.ShieldAlert,{className:"w-4 h-4"}),c?"Approval in Progress":x&&d?"Apply Direct Correction":u?"Request Profile Edit":"Edit Profile Details"]}),(0,r.jsxs)("button",{onClick:()=>o(!0),className:"w-full py-3 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/40 text-blue-600 dark:text-blue-400 rounded-xl text-sm font-semibold transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(z,{className:"w-4 h-4"}),"Request Center Transfer"]}),(0,r.jsxs)("button",{onClick:i,className:"w-full py-3 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-xl text-sm font-semibold transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)(T.Eye,{className:"w-4 h-4"}),"View Full Details"]})]})]})]}),n&&(0,r.jsx)(X,{customer:e,onClose:()=>o(!1),onSuccess:()=>{}})]})}var G=e.i(50788),W=e.i(18566);function H(){let[e,d]=(0,a.useState)([]),[c,x]=(0,a.useState)([]),[m,u]=(0,a.useState)(null),[b,h]=(0,a.useState)(!1),[p,v]=(0,a.useState)(!1),[j,k]=(0,a.useState)(!1),[_,N]=(0,a.useState)(""),[w,C]=(0,a.useState)("All"),[S,q]=(0,a.useState)(!0),[P,A]=(0,a.useState)(!1),[D,F]=(0,a.useState)(!1),[B,R]=(0,a.useState)(!1),I=a.default.useRef(null),[T,E]=(0,a.useState)({customer:null}),z=(0,W.useRouter)(),[U,O]=(0,a.useState)(null);(0,a.useEffect)(()=>{{let e,r,a=(e=y.authService.hasPermission("customers.view"),r=y.authService.hasRole("super_admin"),!!e||!!r||($.toast.error("You do not have permission to view customers"),z.push("/"),!1));O(a),a&&Y()}},[z]);let[X,H]=(0,a.useState)({totalCustomers:0,activeCustomers:0,customersWithLoans:0,newThisMonth:0});(0,a.useEffect)(()=>{K()},[e,_,w]);let Y=async()=>{q(!0);try{let e=await o.customerService.getCustomers();d(e),H({totalCustomers:e.length,activeCustomers:e.length,customersWithLoans:0,newThisMonth:0})}catch(e){console.error("Failed to load customers",e),$.toast.error("Failed to load customers")}finally{q(!1)}},K=()=>{let r=e;_&&(r=r.filter(e=>e.full_name.toLowerCase().includes(_.toLowerCase())||e.customer_code.toLowerCase().includes(_.toLowerCase())||e.mobile_no_1.includes(_))),"All"!==w&&(r=r.filter(e=>e.gender===w)),x(r)},Z=e=>{u(e),k(!0)},J=async()=>{if(T.customer)try{await o.customerService.deleteCustomer(T.customer.id),$.toast.success("Customer deleted successfully"),Y()}catch(e){$.toast.error(e.message||"Failed to delete customer")}finally{A(!1),E({customer:null})}},Q=(e,r)=>{E({customer:e,newStatus:r}),F(!0)},ee=async()=>{if(!T.customer||!T.newStatus)return;let{customer:e,newStatus:r}=T;try{await o.customerService.updateCustomer(e.id,{status:r}),$.toast.success(`Customer ${"blocked"===r?"disabled":"enabled"} successfully`),Y()}catch(e){$.toast.error(e.message||"Failed to update customer status")}finally{F(!1),E({customer:null})}},er=async e=>m?await o.customerService.updateCustomer(m.id,e):await o.customerService.createCustomer(e),ea=()=>{v(!1),k(!1),u(null),Y()},es=async()=>{try{await o.customerService.exportCustomers(),$.toast.success("Customers exported successfully")}catch(e){$.toast.error(e.message||"Failed to export customers")}},et=async e=>{let r=e.target.files?.[0];if(r){if(!r.name.endsWith(".csv"))return void $.toast.error("Please upload a valid CSV file");R(!0);try{await o.customerService.importCustomers(r),$.toast.success("Customers imported successfully"),Y()}catch(e){$.toast.error(e.message||"Failed to import customers")}finally{R(!1),I.current&&(I.current.value="")}}};return!1===U?null:null===U?(0,r.jsxs)("div",{className:"p-12 text-center",children:[(0,r.jsx)("div",{className:"inline-block w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-3",children:"Verifying permissions..."})]}):(0,r.jsxs)("div",{className:"p-6 max-w-7xl mx-auto space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Customer List"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage and track all customer information"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[(0,r.jsx)("input",{type:"file",ref:I,onChange:et,accept:".csv",className:"hidden"}),y.authService.hasPermission("customers.view")&&(0,r.jsxs)("button",{onClick:()=>I.current?.click(),disabled:B,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2.5 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-all shadow-sm font-medium text-sm disabled:opacity-50",children:[(0,r.jsx)(n.Upload,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),(0,r.jsx)("span",{children:B?"Importing...":"Import CSV"})]}),y.authService.hasPermission("customers.view")&&(0,r.jsxs)("button",{onClick:es,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2.5 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-all shadow-sm font-medium text-sm",children:[(0,r.jsx)(l.Download,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),(0,r.jsx)("span",{children:"Export CSV"})]}),y.authService.hasPermission("customers.create")&&(0,r.jsxs)("button",{onClick:()=>v(!0),className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all shadow-md shadow-blue-200 dark:shadow-none font-medium text-sm",children:[(0,r.jsx)(s.Plus,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Add Customer"})]})]})]}),(0,r.jsx)(g,{stats:X}),(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 shadow-sm",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(t.Search,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),(0,r.jsx)("input",{type:"text",placeholder:"Search customers by name, NIC, or mobile...",value:_,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all dark:text-white"})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-3",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 border border-gray-200 dark:border-gray-600 rounded-xl px-3 bg-gray-50 dark:bg-gray-700 transition-all focus-within:ring-2 focus-within:ring-blue-500/20",children:[(0,r.jsx)(i.Filter,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),(0,r.jsxs)("select",{value:w,onChange:e=>C(e.target.value),className:"bg-transparent border-none text-sm py-2.5 focus:outline-none text-gray-700 dark:text-gray-200",children:[(0,r.jsx)("option",{value:"All",children:"All Genders"}),(0,r.jsx)("option",{value:"Female",children:"Female"}),(0,r.jsx)("option",{value:"Male",children:"Male"})]})]})})]})}),(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 items-start",children:[(0,r.jsx)("div",{className:"flex-1 min-w-0 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:S?(0,r.jsxs)("div",{className:"p-12 text-center",children:[(0,r.jsx)("div",{className:"inline-block w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-3",children:"Loading customers..."})]}):0===c.length?(0,r.jsxs)("div",{className:"p-12 text-center",children:[(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No customers found"}),(0,r.jsx)("button",{onClick:()=>v(!0),className:"mt-4 text-blue-600 dark:text-blue-400 hover:underline text-sm font-medium",children:"Add your first customer"})]}):(0,r.jsx)(f,{customers:c,onEdit:Z,onDelete:r=>{E({customer:e.find(e=>e.id===r)||null}),A(!0)},onStatusChange:Q,onViewDetails:e=>{m?.id===e.id?u(null):u(e)},selectedCustomer:m})}),m&&(0,r.jsx)("div",{className:"w-full lg:w-[400px] flex-shrink-0",children:(0,r.jsx)(V,{customer:m,onClose:()=>u(null),onEdit:Z,onViewFullDetails:()=>{h(!0)},onStatusChange:Q})})]}),b&&m&&(0,r.jsx)(M,{customer:m,onClose:()=>{h(!1)}}),p&&(0,r.jsx)(L,{onClose:ea,onSubmit:er}),j&&m&&(0,r.jsx)(L,{onClose:ea,onSubmit:er,initialData:m}),(0,r.jsx)(G.ConfirmDialog,{isOpen:P,title:"Delete Customer Profile",message:`Are you sure you want to permanently delete ${T.customer?.full_name}'s profile? This action cannot be undone.`,confirmText:"Permanently Delete",cancelText:"Cancel",variant:"danger",onConfirm:J,onCancel:()=>A(!1)}),(0,r.jsx)(G.ConfirmDialog,{isOpen:D,title:"blocked"===T.newStatus?"Disable Customer":"Activate Customer",message:`Are you sure you want to ${"blocked"===T.newStatus?"disable":"enable"} ${T.customer?.full_name}? ${"blocked"===T.newStatus?"They will no longer be eligible for new transactions.":"They will be able to perform transactions again."}`,confirmText:"blocked"===T.newStatus?"Yes, Disable":"Yes, Activate",cancelText:"Cancel",variant:"blocked"===T.newStatus?"warning":"info",onConfirm:ee,onCancel:()=>F(!1)})]})}e.s(["default",()=>H],34806)}]);