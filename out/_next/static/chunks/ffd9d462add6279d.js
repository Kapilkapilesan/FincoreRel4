(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,95508,e=>{"use strict";var a=e.i(43476),r=e.i(71645),t=e.i(7233),s=e.i(70319),d=e.i(61911),l=e.i(82293),n=e.i(98919);function i({stats:e}){return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,a.jsx)("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:(0,a.jsx)(d.Users,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})})}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Total Users"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.totalUsers})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:(0,a.jsx)(l.UserCheck,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),(0,a.jsxs)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:[e.totalUsers>0?(e.activeUsers/e.totalUsers*100).toFixed(0):0,"%"]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Active Users"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.activeUsers})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,a.jsx)("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:(0,a.jsx)(n.Shield,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})})}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"User Roles"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.totalRoles})]})]})}var c=e.i(88511),o=e.i(27612);let x=(0,e.i(75254).default)("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);var g=e.i(70756),m=e.i(69638),u=e.i(73884),b=e.i(3116),h=e.i(63209),y=e.i(93845),p=e.i(98094),f=e.i(37727),j=e.i(63488),k=e.i(43432),v=e.i(46897),N=e.i(87316),w=e.i(84614),_=e.i(63727),C=e.i(42920);function S({staff:e,onClose:r}){return e?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full shadow-xl border border-gray-200 dark:border-gray-700 max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 rounded-t-lg z-10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Staff Details"}),(0,a.jsx)("button",{onClick:r,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:(0,a.jsx)(f.X,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]})}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 pb-6 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-white text-2xl font-bold",children:e.full_name?.charAt(0)||e.name?.charAt(0)||"S"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.full_name||e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name_with_initial||""}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${"active"===e.account_status||e.is_active?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-300"}`,children:"active"===e.account_status||e.is_active?"Active":"Inactive"}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-xs font-medium",children:e.role_name||e.role||"Staff"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.staff_id&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg",children:(0,a.jsx)(_.Briefcase,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Staff ID"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.staff_id})]})]}),(e.email_id||e.email)&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-purple-50 dark:bg-purple-900/30 rounded-lg",children:(0,a.jsx)(j.Mail,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Email"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.email_id||e.email})]})]}),e.contact_no&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-green-50 dark:bg-green-900/30 rounded-lg",children:(0,a.jsx)(k.Phone,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Contact Number"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.contact_no})]})]}),e.nic&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-orange-50 dark:bg-orange-900/30 rounded-lg",children:(0,a.jsx)(w.User,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"NIC"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.nic})]})]}),(e.age||e.gender)&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-pink-50 dark:bg-pink-900/30 rounded-lg",children:(0,a.jsx)(w.User,{className:"w-5 h-5 text-pink-600 dark:text-pink-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Age & Gender"}),(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:[e.age&&`${e.age} years`," ",e.gender&&`â€¢ ${e.gender}`]})]})]}),(e.branch_id||e.branch)&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg",children:(0,a.jsx)(C.Building,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Branch"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.branch?.name||e.branch||`Branch ${e.branch_id}`})]})]})]}),e.address&&(0,a.jsx)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-teal-50 dark:bg-teal-900/30 rounded-lg",children:(0,a.jsx)(v.MapPin,{className:"w-5 h-5 text-teal-600 dark:text-teal-400"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Address"}),(0,a.jsx)("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:e.address})]})]})}),e.work_info&&(0,a.jsx)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg",children:(0,a.jsx)(N.Calendar,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Work Information"}),(0,a.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:"string"==typeof e.work_info?(0,a.jsx)("pre",{className:"whitespace-pre-wrap",children:e.work_info}):(0,a.jsxs)("div",{className:"space-y-1",children:[e.work_info.designation&&(0,a.jsxs)("p",{children:["Designation: ",e.work_info.designation]}),e.work_info.joined_date&&(0,a.jsxs)("p",{children:["Joined: ",e.work_info.joined_date]})]})})]})]})})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end bg-gray-50 dark:bg-gray-900/50 rounded-b-lg",children:(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm",children:"Close"})})]})}):null}function A({users:e,onEdit:t,onDelete:d,onRefresh:l}){let[n,i]=(0,r.useState)(null),[f,j]=(0,r.useState)(!1),[k,v]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),[_,C]=(0,r.useState)({show:!1,title:"",message:"",type:"info",onConfirm:()=>{}}),A=async e=>{if(e.staffId){v(!0);try{let a=await y.staffService.getStaffDetails(e.staffId);a&&(i(a),j(!0))}catch(e){console.error("Failed to load staff details",e)}finally{v(!1)}}},U=async e=>{if(e.today_session){w(`approve-${e.id}`);try{await p.sessionService.approveAttendance(e.today_session.id),s.toast.success(`Attendance approved for ${e.name}`),l?.()}catch(e){s.toast.error(e.message||"Failed to approve attendance")}finally{w(null)}}},$=e=>{let a=Math.floor(e/60),r=e%60;return a>0?`${a}h ${r}m`:`${r}m`};return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700 px-6 py-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase",children:[(0,a.jsx)("div",{className:"col-span-2",children:"Name"}),(0,a.jsx)("div",{className:"col-span-2",children:"Email"}),(0,a.jsx)("div",{className:"col-span-1",children:"Role"}),(0,a.jsx)("div",{className:"col-span-1",children:"Branch"}),(0,a.jsx)("div",{className:"col-span-1",children:"Status"}),(0,a.jsx)("div",{className:"col-span-2",children:"Attendance"}),(0,a.jsx)("div",{className:"col-span-3",children:"Actions"})]})}),(0,a.jsx)("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:e.map(e=>{let r=!!e.staffId,n=e.is_locked,i=e.today_session?.attendance_status==="PENDING"&&e.today_session?.status==="OPEN",y=e.today_session?.status==="CLOSED"&&e.today_session?.logout_type==="LOGOUT";return(0,a.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-center",children:[(0,a.jsxs)("div",{className:"col-span-2 flex items-center gap-3",children:[(0,a.jsxs)("div",{className:`w-10 h-10 ${n?"bg-red-500":"bg-blue-600"} rounded-lg flex items-center justify-center flex-shrink-0 relative`,children:[(0,a.jsx)("span",{className:"text-white text-sm font-semibold",children:e.name.charAt(0)}),n&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(h.AlertCircle,{className:"w-3 h-3 text-white"})})]}),(0,a.jsxs)("div",{className:"min-w-0",children:[r?(0,a.jsx)("button",{onClick:()=>A(e),disabled:k,className:"font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 truncate text-left underline decoration-dotted hover:decoration-solid transition-all disabled:opacity-50 block",children:k?"Loading...":e.name}):(0,a.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:e.name}),n&&(0,a.jsx)("span",{className:"text-xs text-red-500 font-medium",children:"ðŸ”’ Locked"})]})]}),(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:e.email})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-xs font-medium truncate",children:e.role})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:e.branch})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${"Active"===e.status?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-300"}`,children:e.status})}),(0,a.jsx)("div",{className:"col-span-2",children:(e=>{let r=e.today_session;if(!r)return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 dark:bg-gray-900/30 text-gray-500 dark:text-gray-400 rounded text-xs",children:[(0,a.jsx)(b.Clock,{className:"w-3 h-3"})," Not Logged In"]});if("CLOSED"===r.status)return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 dark:bg-gray-900/30 text-gray-600 dark:text-gray-400 rounded text-xs",children:[(0,a.jsx)(b.Clock,{className:"w-3 h-3"})," Logged Out (",$(r.worked_minutes),")"]});switch(r.attendance_status){case"APPROVED":return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded text-xs",children:[(0,a.jsx)(m.CheckCircle,{className:"w-3 h-3"})," Approved"]});case"PENDING":return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded text-xs",children:[(0,a.jsx)(h.AlertCircle,{className:"w-3 h-3"})," Pending"]});case"REJECTED":return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded text-xs",children:[(0,a.jsx)(u.XCircle,{className:"w-3 h-3"})," Rejected"]});default:return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-xs",children:[(0,a.jsx)(b.Clock,{className:"w-3 h-3"})," ",$(r.worked_minutes)]})}})(e)}),(0,a.jsxs)("div",{className:"col-span-3 flex items-center gap-1 flex-wrap",children:[n||y?(0,a.jsxs)("button",{onClick:()=>{C({show:!0,title:"Unlock User Account",message:`Are you sure you want to unlock ${e.name}'s account? This will restore their access to the system.`,type:"info",onConfirm:async()=>{w(`unlock-${e.id}`);try{await p.sessionService.unlockUserAccount(Number(e.id)),s.toast.success(`${e.name}'s account has been unlocked`),l?.()}catch(e){s.toast.error(e.message||"Failed to unlock account")}finally{w(null)}}})},disabled:N===`unlock-${e.id}`,className:"inline-flex items-center gap-1 px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded text-xs font-medium hover:bg-orange-200 dark:hover:bg-orange-900/50 transition-colors disabled:opacity-50",title:n?"Unlock Account and Session":"Reopen Accidental Logout",children:[(0,a.jsx)(x,{className:"w-3 h-3"}),N===`unlock-${e.id}`?"...":n?"Unlock":"Reopen"]}):r&&(0,a.jsxs)("button",{onClick:()=>{C({show:!0,title:"Lock User Account",message:`Are you sure you want to LOCK ${e.name}'s account? This will immediately terminate any active session and prevent further access.`,type:"danger",onConfirm:async()=>{w(`lock-${e.id}`);try{await p.sessionService.lockUserAccount(Number(e.id)),s.toast.success(`${e.name}'s account has been manually locked`),l?.()}catch(e){s.toast.error(e.message||"Failed to lock account")}finally{w(null)}}})},disabled:N===`lock-${e.id}`,className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded text-xs font-medium hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors disabled:opacity-50",title:"Lock Account (Manager Action)",children:[(0,a.jsx)(g.Lock,{className:"w-3 h-3"}),N===`lock-${e.id}`?"...":"Lock"]}),i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>U(e),disabled:N===`approve-${e.id}`,className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded text-xs font-medium hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors disabled:opacity-50",title:"Approve Attendance",children:[(0,a.jsx)(m.CheckCircle,{className:"w-3 h-3"}),N===`approve-${e.id}`?"...":"Approve"]}),(0,a.jsxs)("button",{onClick:()=>{e.today_session&&C({show:!0,title:"Reject Attendance",message:`Please provide a reason for rejecting ${e.name}'s attendance for today.`,type:"warning",showInput:!0,inputLabel:"Rejection Reason",inputValue:"",onConfirm:async()=>{let a=_.inputValue;if(!a)return void s.toast.error("Rejection reason is required");w(`reject-${e.id}`);try{await p.sessionService.rejectAttendance(e.today_session.id,a),s.toast.success(`Attendance rejected for ${e.name}`),l?.()}catch(e){s.toast.error(e.message||"Failed to reject attendance")}finally{w(null)}}})},disabled:N===`reject-${e.id}`,className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded text-xs font-medium hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors disabled:opacity-50",title:"Reject Attendance",children:[(0,a.jsx)(u.XCircle,{className:"w-3 h-3"}),N===`reject-${e.id}`?"...":"Reject"]})]}),(0,a.jsx)("button",{onClick:()=>t(e),className:"p-1.5 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded text-blue-600 dark:text-blue-400",title:"Edit User",children:(0,a.jsx)(c.Edit,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>d(e.id),className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 rounded text-red-600 dark:text-red-400",title:"Delete User",children:(0,a.jsx)(o.Trash2,{className:"w-4 h-4"})})]})]})},e.id)})}),0===e.length&&(0,a.jsx)("div",{className:"px-6 py-12 text-center",children:(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No users found"})}),(0,a.jsx)("div",{className:"bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700 px-6 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",(0,a.jsx)("span",{className:"font-medium",children:e.length})," of ",(0,a.jsx)("span",{className:"font-medium",children:e.length})," users"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 disabled:opacity-50",children:"Previous"}),(0,a.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white rounded text-sm",children:"1"}),(0,a.jsx)("button",{className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 disabled:opacity-50",children:"Next"})]})]})}),f&&n&&(0,a.jsx)(S,{staff:n,onClose:()=>{j(!1),i(null)}}),_.show&&(0,a.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm animate-in fade-in duration-200",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-in zoom-in-95 duration-200",children:[(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 ${"danger"===_.type?"bg-red-100 dark:bg-red-900/30":"warning"===_.type?"bg-orange-100 dark:bg-orange-900/30":"bg-blue-100 dark:bg-blue-900/30"}`,children:"danger"===_.type?(0,a.jsx)(g.Lock,{className:"w-6 h-6 text-red-600 dark:text-red-400"}):"warning"===_.type?(0,a.jsx)(h.AlertCircle,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"}):(0,a.jsx)(x,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:_.title}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-1 leading-relaxed",children:_.message}),_.showInput&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:_.inputLabel}),(0,a.jsx)("textarea",{className:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition-all dark:text-white",rows:3,placeholder:"Enter reason here...",value:_.inputValue,onChange:e=>C({..._,inputValue:e.target.value}),autoFocus:!0})]})]})]})}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 flex items-center justify-end gap-3",children:[(0,a.jsx)("button",{onClick:()=>C({..._,show:!1}),className:"px-6 py-2.5 text-sm font-semibold text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{_.onConfirm(),C({..._,show:!1})},className:`px-8 py-2.5 rounded-xl text-sm font-bold text-white shadow-lg transition-all active:scale-95 ${"danger"===_.type?"bg-red-600 hover:bg-red-700 shadow-red-200 dark:shadow-none":"warning"===_.type?"bg-orange-600 hover:bg-orange-700 shadow-orange-200 dark:shadow-none":"bg-blue-600 hover:bg-blue-700 shadow-blue-200 dark:shadow-none"}`,children:"Confirm"})]})]})})]})}function U({roles:e,permissions:r}){return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Available Roles"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>(0,a.jsx)("button",{className:"px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors text-sm font-medium",children:e.display_name||e},e.id||e))})]}),(0,a.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700 px-4 py-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-5 gap-4 text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase",children:[(0,a.jsx)("div",{className:"col-span-1",children:"Module"}),(0,a.jsx)("div",{className:"col-span-1 text-center",children:"View"}),(0,a.jsx)("div",{className:"col-span-1 text-center",children:"Create"}),(0,a.jsx)("div",{className:"col-span-1 text-center",children:"Edit"}),(0,a.jsx)("div",{className:"col-span-1 text-center",children:"Delete"})]})}),(0,a.jsx)("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:r.map((e,r)=>(0,a.jsx)("div",{className:"px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:(0,a.jsxs)("div",{className:"grid grid-cols-5 gap-4 items-center",children:[(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.module})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-center",children:(0,a.jsx)("input",{type:"checkbox",checked:e.view,readOnly:!0,className:"w-4 h-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 focus:ring-blue-500"})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-center",children:(0,a.jsx)("input",{type:"checkbox",checked:e.create,readOnly:!0,className:"w-4 h-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 focus:ring-blue-500"})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-center",children:(0,a.jsx)("input",{type:"checkbox",checked:e.edit,readOnly:!0,className:"w-4 h-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 focus:ring-blue-500"})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-center",children:(0,a.jsx)("input",{type:"checkbox",checked:e.delete,readOnly:!0,className:"w-4 h-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 focus:ring-blue-500"})})]})},r))})]}),(0,a.jsx)("div",{className:"mt-4 flex justify-end",children:(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Save Permissions"})})]})}var $=e.i(86536),I=e.i(77705),R=e.i(13477),E=e.i(42365);function P({onClose:e,onSubmit:t,roles:d,initialData:l}){var n;let i,[c,o]=(0,r.useState)({name:l?.name||"",name_with_initial:l?.name_with_initial||"",email:l?.email||"",roleId:l?.role?(n=l.role,(i=d.find(e=>e.display_name===n||e.name===n))?i.id.toString():""):"",branch:l?.branchId?.toString()||"",password:"",isActive:!l||"Active"===l.status,nic:l?.nic||"",contactKey:l?.contact_no||"",address:l?.address||"",gender:l?.gender||"Male",age:l?.age||""}),[x,g]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[b,h]=(0,r.useState)(!1),[p,j]=(0,r.useState)(""),[k,v]=(0,r.useState)({}),[N,w]=(0,r.useState)([]),_=!!l,C=d.find(e=>e.id.toString()===c.roleId),S=C?.name==="admin"||C?.name==="super_admin"||1===d.length&&"admin"===d[0].name;(0,r.useEffect)(()=>{(async()=>{try{let e=await R.branchService.getBranches();w(e)}catch(e){console.error("Failed to fetch branches",e)}})()},[]),(0,r.useEffect)(()=>{(async()=>{let e=l?.staffId;if(_&&!S&&e){u(!0);try{let a=await y.staffService.getStaffDetails(e);a&&o(e=>({...e,name:a.full_name||e.name,name_with_initial:a.name_with_initial||"",nic:a.nic||"",address:a.address||"",contactKey:a.contact_no||"",age:a.age?.toString()||"",gender:a.gender||"Male",branch:a.branch_id?.toString()||e.branch||"",isActive:a.account_status?"active"===a.account_status.toLowerCase():e.isActive}))}catch(e){console.error("Failed to load staff details",e)}finally{u(!1)}}})()},[_,S,l]);let A=e=>{let a="checkbox"===e.target.type?e.target.checked:e.target.value;o({...c,[e.target.name]:a}),k[e.target.name]&&v(a=>({...a,[e.target.name]:""}))},U=async()=>{let a;if(a={},c.roleId||(a.roleId="Role is required"),S||c.name.trim()||(a.name="Full Name is required"),c.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)||(a.email="Invalid email format"):a.email="Email is required",!S&&(c.name_with_initial.trim()||(a.name_with_initial="Name with initials is required"),c.nic.trim()?/^([0-9]{9}[x|X|v|V]|[0-9]{12})$/.test(c.nic)||(a.nic="Invalid NIC format (9 digits+V/X or 12 digits)"):a.nic="NIC is required",c.contactKey.trim()?/^\d{10}$/.test(c.contactKey)||(a.contactKey="Contact number must be 10 digits"):a.contactKey="Contact number is required",c.address.trim()||(a.address="Address is required"),c.age?(18>parseInt(c.age)||parseInt(c.age)>80)&&(a.age="Age must be between 18 and 80"):a.age="Age is required"),_||!S||c.password||(a.password="Password is required for new admins"),v(a),0===Object.keys(a).length){g(!0);try{let a=C?.name||"",r={name:c.name,email:c.email,role:a,roleId:c.roleId,is_active:c.isActive,staffId:_?l?.staffId||l?.id:void 0};c.password&&(r.password=c.password),c.branch&&(r.branch=c.branch),S||(r.staffDetails={full_name:c.name,name_with_initial:c.name_with_initial||c.name,email_id:c.email,contact_no:c.contactKey,address:c.address,nic:c.nic,gender:c.gender,age:parseInt(c.age),role_name:a,account_status:c.isActive?"active":"inactive",work_info:{designation:a,joined_date:new Date().toISOString().split("T")[0]},profile_image:"default_avatar.png",branch_id:c.branch?parseInt(c.branch):null});let d=await t(r);s.toast.success(d?.message||(_?"User updated successfully":"User created successfully")),e()}catch(e){s.toast.error(e.message||"Failed to save user")}finally{g(!1)}}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 backdrop-blur-sm overflow-y-auto",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full shadow-xl border border-gray-200 dark:border-gray-700 my-8 max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 rounded-t-lg z-10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:_?"Edit User":"Add New User"}),(0,a.jsx)("button",{onClick:e,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:(0,a.jsx)(f.X,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]})}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[p&&(0,a.jsx)("div",{className:"p-3 bg-red-50 text-red-700 text-sm rounded-lg",children:p}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Role *"}),(0,a.jsxs)("select",{name:"roleId",value:c.roleId,onChange:A,className:`w-full px-3 py-2 border ${k.roleId?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,children:[(0,a.jsx)("option",{value:"",children:"Select Role"}),d.map(e=>(0,a.jsx)("option",{value:e.id,children:e.display_name},e.id))]}),k.roleId&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.roleId})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[!S&&(0,a.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Full Name *"}),(0,a.jsx)("input",{name:"name",value:c.name,onChange:A,type:"text",className:`w-full px-3 py-2 border ${k.name?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm disabled:opacity-50 disabled:bg-gray-100 dark:disabled:bg-gray-700`,placeholder:"Enter full name",disabled:_&&S}),k.name&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.name})]}),!S&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Name with Initials *"}),(0,a.jsx)("input",{name:"name_with_initial",value:c.name_with_initial,onChange:A,type:"text",className:`w-full px-3 py-2 border ${k.name_with_initial?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,placeholder:"e.g. A.B.C Perera"}),k.name_with_initial&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.name_with_initial})]}),(0,a.jsxs)("div",{className:S?"col-span-1 md:col-span-2":"",children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Email *"}),(0,a.jsx)("input",{name:"email",value:c.email,onChange:A,type:"email",className:`w-full px-3 py-2 border ${k.email?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,placeholder:"user@example.com"}),k.email&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.email})]})]}),!S&&(0,a.jsxs)("div",{className:"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider",children:"Staff Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"NIC Number *"}),(0,a.jsx)("input",{name:"nic",value:c.nic,onChange:A,type:"text",className:`w-full px-3 py-2 border ${k.nic?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,placeholder:"National Identity Card"}),k.nic&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.nic})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Contact Number *"}),(0,a.jsx)("input",{name:"contactKey",value:c.contactKey,onChange:A,type:"text",className:`w-full px-3 py-2 border ${k.contactKey?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,placeholder:"Mobile Number"}),k.contactKey&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.contactKey})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Age *"}),(0,a.jsx)("input",{name:"age",value:c.age,onChange:A,type:"number",min:"18",max:"80",className:`w-full px-3 py-2 border ${k.age?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`}),k.age&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.age})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Gender *"}),(0,a.jsxs)("select",{name:"gender",value:c.gender,onChange:A,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[(0,a.jsx)("option",{value:"Male",children:"Male"}),(0,a.jsx)("option",{value:"Female",children:"Female"})]})]}),(0,a.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Residential Address *"}),(0,a.jsx)("textarea",{name:"address",value:c.address,onChange:A,rows:3,className:`w-full px-3 py-2 border ${k.address?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,placeholder:"Full Address"}),k.address&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.address})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Branch (Optional)"}),(0,a.jsxs)("select",{name:"branch",value:c.branch,onChange:A,className:`w-full px-3 py-2 border ${k.branch?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,children:[(0,a.jsx)("option",{value:"",children:"Select Branch"}),N.map(e=>(0,a.jsx)("option",{value:e.id,children:e.branch_name},e.id))]}),k.branch&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.branch})]})]})]}),!_&&(0,a.jsxs)("div",{className:"relative pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:["Password ",S?"*":"(Optional - defaults to NIC)"]}),(0,a.jsx)("input",{name:"password",value:c.password,onChange:A,type:b?"text":"password",className:`w-full px-3 py-2 border ${k.password?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm pr-10`,placeholder:"Enter password"}),k.password&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.password}),(0,a.jsx)("button",{type:"button",onClick:()=>h(!b),className:"absolute right-3 top-[60%] text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:b?(0,a.jsx)(I.EyeOff,{className:"w-4 h-4"}):(0,a.jsx)($.Eye,{className:"w-4 h-4"})})]}),_&&E.authService.hasRole("super_admin")&&(0,a.jsx)("div",{className:"flex items-center gap-3 pt-2",children:(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",name:"isActive",checked:c.isActive,onChange:A,className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),(0,a.jsx)("span",{className:"ml-3 text-sm font-medium text-gray-900 dark:text-gray-300",children:c.isActive?"Active User":"Inactive User"})]})})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end bg-gray-50 dark:bg-gray-900/50 rounded-b-lg",children:[(0,a.jsx)("button",{onClick:e,disabled:x,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-white dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-colors font-medium text-sm disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:U,disabled:x,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm disabled:opacity-50 flex items-center gap-2",children:x?_?"Updating...":"Adding...":_?"Update User":"Add User"})]})]})})}var F=e.i(18566);function O(){let[e,d]=(0,r.useState)("users"),[l,n]=(0,r.useState)(!1),[c,o]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),[m,u]=(0,r.useState)([]),[b,h]=(0,r.useState)(!0),[p,f]=(0,r.useState)(null),[j,k]=(0,r.useState)(""),[v,N]=(0,r.useState)(null),w=(0,F.useRouter)();(0,r.useEffect)(()=>{{let e,a,r=(e=E.authService.hasPermission("staff.view")||E.authService.hasPermission("users.view"),a=E.authService.hasRole("super_admin"),!!e||!!a||(console.warn("[Security] Unauthorized access attempt to staff-management. Redirecting..."),w.push("/"),!1));if(N(r),!r)return}let e=localStorage.getItem("roles");if(e)try{let a=JSON.parse(e);Array.isArray(a)&&a.length>0&&(a.some(e=>"super_admin"===e.name)?k("super_admin"):a.some(e=>"admin"===e.name)?k("admin"):k(a[0].name))}catch(e){}_()},[w]);let _=async()=>{try{let e=!1;{let a=localStorage.getItem("roles");a&&a.includes("super_admin")&&(e=!0)}let a=e?"admins":"staff",[r,t,s]=await Promise.all([y.staffService.getUsers(a),y.staffService.getAllRoles(),y.staffService.getPermissions()]);o(r),g(t),u(s)}catch(e){console.error("Failed to load staff data",e)}finally{h(!1)}},C=async e=>{try{let a;return p?(a=await y.staffService.updateUser(p.id,e),s.toast.success("User updated successfully!")):(a=await y.staffService.createUser(e),s.toast.success("User created successfully!")),n(!1),f(null),_(),a}catch(e){throw console.error("Failed to save user",e),s.toast.error(e.message||"Failed to save user"),e}},S=async e=>{if(window.confirm("Are you sure you want to delete this user?"))try{await y.staffService.deleteUser(e),o(c.filter(a=>a.id!==e)),s.toast.success("User deleted successfully!")}catch(e){console.error("Failed to delete user",e),s.toast.error(e.message||"Failed to delete user")}},$={totalUsers:c.length,activeUsers:c.filter(e=>"Active"===e.status).length,totalRoles:x.length};return!1===v?null:b||null===v?(0,a.jsx)("div",{className:"p-6",children:"Loading..."}):(0,a.jsxs)("div",{className:"space-y-6 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"User Management"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage users, roles, and permissions"})]}),"users"===e&&(0,a.jsxs)("button",{onClick:()=>{f(null),n(!0)},className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:[(0,a.jsx)(t.Plus,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Add User"})]})]}),(0,a.jsx)(i,{stats:$}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("button",{onClick:()=>d("users"),className:`px-6 py-3 border-b-2 transition-colors text-sm font-medium ${"users"===e?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Staff Users"}),(0,a.jsx)("button",{onClick:()=>d("roles"),className:`px-6 py-3 border-b-2 transition-colors text-sm font-medium ${"roles"===e?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Roles & Privileges"})]})}),"users"===e&&(0,a.jsx)(A,{users:c,onEdit:e=>{f(e),n(!0)},onDelete:S,onRefresh:_}),"roles"===e&&(0,a.jsx)(U,{roles:x,permissions:m})]}),l&&(0,a.jsx)(P,{onClose:()=>{n(!1),f(null)},onSubmit:C,initialData:p,roles:x.filter(e=>"super_admin"===j?"admin"===e.name:"admin"!==j||"super_admin"!==e.name&&"admin"!==e.name)})]})}e.s(["default",()=>O],95508)}]);