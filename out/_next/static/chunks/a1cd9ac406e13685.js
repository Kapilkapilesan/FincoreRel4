(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,658,e=>{"use strict";var t=e.i(64397);let s={credentials:"include"};async function r(e){let t=e.headers.get("content-type")?.includes("application/json")?await e.json():null;if(!e.ok){if(t&&(422===e.status||409===e.status)){let e=Error(t.error||t.message||"Validation failed");throw e.errors=t.errors,e}let s=t&&(t.error||t.message)||e.statusText;throw Error(`API Error ${e.status}: ${s}`)}return t.data}e.s(["centerService",0,{getCenters:async()=>{try{let e=await fetch(`${t.API_BASE_URL}/centers`,{...s,headers:(0,t.getHeaders)()});return r(e)}catch(e){return console.error("Error fetching centers:",e),[]}},getCenterById:async e=>r(await fetch(`${t.API_BASE_URL}/centers/${e}`,{...s,headers:(0,t.getHeaders)()})),createCenter:async e=>r(await fetch(`${t.API_BASE_URL}/centers`,{method:"POST",...s,headers:(0,t.getHeaders)(),body:JSON.stringify(e)})),updateCenter:async(e,a)=>r(await fetch(`${t.API_BASE_URL}/centers/${e}`,{method:"PUT",...s,headers:(0,t.getHeaders)(),body:JSON.stringify(a)})),deleteCenter:async e=>{let r=await fetch(`${t.API_BASE_URL}/centers/${e}`,{method:"DELETE",...s,headers:(0,t.getHeaders)()});if(!r.ok){let e=r.headers.get("content-type")?.includes("application/json")?await r.json():null,t=e&&e.message||r.statusText;throw Error(`Delete failed ${r.status}: ${t}`)}},approveCenter:async e=>r(await fetch(`${t.API_BASE_URL}/centers/${e}/approve`,{method:"PATCH",...s,headers:(0,t.getHeaders)()})),rejectCenter:async(e,r)=>{let a=await fetch(`${t.API_BASE_URL}/centers/${e}/reject`,{method:"POST",...s,headers:(0,t.getHeaders)(),body:JSON.stringify({rejection_reason:r})});if(!a.ok){let e=a.headers.get("content-type")?.includes("application/json")?await a.json():null,t=e&&e.message||a.statusText;throw Error(`Rejection failed ${a.status}: ${t}`)}},toggleCenterStatus:async(e,a)=>{let l="active"===a.toLowerCase()?"disabled":"active";return r(await fetch(`${t.API_BASE_URL}/centers/${e}`,{method:"PUT",...s,headers:(0,t.getHeaders)(),body:JSON.stringify({status:l})}))}}])},27612,e=>{"use strict";let t=(0,e.i(75254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],27612)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},88511,e=>{"use strict";let t=(0,e.i(75254).default)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>t],88511)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},81203,13130,4405,e=>{"use strict";let t=(0,e.i(75254).default)("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);e.s(["Power",()=>t],81203);var s=e.i(71645);function r({totalItems:e,initialItemsPerPage:t=10}){let[r,a]=(0,s.useState)(1),[l,n]=(0,s.useState)(t),i=Math.ceil(e/l),o=(r-1)*l;return(0,s.useEffect)(()=>{a(1)},[e]),{currentPage:r,itemsPerPage:l,totalPages:i,startIndex:o,endIndex:o+l,handlePageChange:e=>{a(e)},handleItemsPerPageChange:e=>{n(e),a(1)}}}e.s(["usePagination",()=>r],13130);var a=e.i(43476),l=e.i(73375),n=e.i(63059);function i({currentPage:e,totalItems:t,itemsPerPage:s,onPageChange:r,onItemsPerPageChange:i,itemName:o="items"}){let c=Math.ceil(t/s),d=(e-1)*s,u=Math.min(d+s,t),m=e=>{r(Math.max(1,Math.min(e,c)))};return 0===t?null:(0,a.jsx)("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Showing ",(0,a.jsx)("span",{className:"font-medium",children:d+1})," to"," ",(0,a.jsx)("span",{className:"font-medium",children:u})," of"," ",(0,a.jsx)("span",{className:"font-medium",children:t})," ",o]}),(0,a.jsxs)("select",{value:s,onChange:e=>i(Number(e.target.value)),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:5,children:"5 per page"}),(0,a.jsx)("option",{value:10,children:"10 per page"}),(0,a.jsx)("option",{value:20,children:"20 per page"}),(0,a.jsx)("option",{value:50,children:"50 per page"})]})]}),c>1&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>m(e-1),disabled:1===e,className:"p-1 border border-gray-300 rounded text-sm text-gray-700 hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Previous page",children:(0,a.jsx)(l.ChevronLeft,{className:"w-4 h-4"})}),(0,a.jsx)("div",{className:"flex gap-1",children:(()=>{let t=[];if(c<=5)for(let e=1;e<=c;e++)t.push(e);else if(e<=3){for(let e=1;e<=4;e++)t.push(e);t.push("..."),t.push(c)}else if(e>=c-2){t.push(1),t.push("...");for(let e=c-3;e<=c;e++)t.push(e)}else{t.push(1),t.push("...");for(let s=e-1;s<=e+1;s++)t.push(s);t.push("..."),t.push(c)}return t.map((t,s)=>"..."===t?(0,a.jsx)("span",{className:"px-3 py-1 text-sm text-gray-700",children:"..."},`ellipsis-${s}`):(0,a.jsx)("button",{onClick:()=>m(t),className:`px-3 py-1 rounded text-sm transition-colors ${e===t?"bg-blue-600 text-white":"border border-gray-300 text-gray-700 hover:bg-white"}`,children:t},t))})()}),(0,a.jsx)("button",{onClick:()=>m(e+1),disabled:e===c,className:"p-1 border border-gray-300 rounded text-sm text-gray-700 hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Next page",children:(0,a.jsx)(n.ChevronRight,{className:"w-4 h-4"})})]})]})})}e.s(["Pagination",()=>i],4405)},25859,e=>{"use strict";var t=e.i(64397);e.s(["customerService",0,{getCustomers:async e=>{try{let s=new URLSearchParams;e?.full_name&&s.append("full_name",e.full_name),e?.customer_code&&s.append("customer_code",e.customer_code),e?.gender&&s.append("gender",e.gender),e?.center_id&&s.append("center_id",e.center_id),e?.branch_id&&s.append("branch_id",e.branch_id),e?.grp_id&&s.append("grp_id",e.grp_id);let r=s.toString(),a=`${t.API_BASE_URL}/customers${r?`?${r}`:""}`,l=await fetch(a,{headers:(0,t.getHeaders)()});if(!l.ok)return[];let n=await l.json();if(n?.data&&Array.isArray(n.data))return n.data;return[]}catch(e){return console.error("Error fetching customers",e),[]}},getConstants:async()=>{try{let e=await fetch(`${t.API_BASE_URL}/customers/constants`,{headers:(0,t.getHeaders)()});if(!e.ok)return null;return(await e.json()).data||null}catch(e){return console.error("Error fetching customer constants",e),null}},getCustomer:async e=>{try{let s=await fetch(`${t.API_BASE_URL}/customers/${e}`,{headers:(0,t.getHeaders)()});if(!s.ok)return null;return(await s.json()).data||null}catch(e){return console.error("Error fetching customer",e),null}},createCustomer:async e=>{let s=await fetch(`${t.API_BASE_URL}/customers`,{method:"POST",headers:(0,t.getHeaders)(),body:JSON.stringify(e)}),r=await s.json();if(!s.ok)throw Error(r.errors?Object.values(r.errors).flat().join(", "):r.message||"Failed to create customer");return r},updateCustomer:async(e,s)=>{let r=await fetch(`${t.API_BASE_URL}/customers/${e}`,{method:"PUT",headers:(0,t.getHeaders)(),body:JSON.stringify(s)}),a=await r.json();if(!r.ok)throw Error(a.errors?Object.values(a.errors).flat().join(", "):a.message||"Failed to update customer");return a},deleteCustomer:async e=>{let s=await fetch(`${t.API_BASE_URL}/customers/${e}`,{method:"DELETE",headers:(0,t.getHeaders)()}),r=await s.json();if(!s.ok)throw Error(r.message||"Failed to delete customer");return r},importCustomers:async e=>{let s=new FormData;s.append("file",e);let r=await fetch(`${t.API_BASE_URL}/customers/import`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:s}),a=await r.json();if(!r.ok)throw Error(a.message||"Failed to import customers");return a},exportCustomers:async()=>{let e=await fetch(`${t.API_BASE_URL}/customers/export`,{headers:(0,t.getHeaders)()});if(!e.ok)throw Error((await e.json().catch(()=>({}))).message||"Failed to export customers");let s=await e.blob(),r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`customers_export_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(r),document.body.removeChild(a)},checkTransferEligibility:async e=>{try{let s=await fetch(`${t.API_BASE_URL}/customers/${e}/transfer-eligibility`,{headers:(0,t.getHeaders)()}),r=await s.json();return{eligible:s.ok,message:r.message}}catch(e){return console.error("Error checking transfer eligibility",e),{eligible:!1,message:"Could not verify eligibility"}}}}])},27331,e=>{"use strict";let t=["Completed","Rejected"];e.s(["LOAN_CLOSED_STATUSES",0,t,"LOAN_STATUS_APPROVED",0,"approved","LOAN_STATUS_PENDING_1ST",0,"pending_1st","LOAN_STATUS_PENDING_2ND",0,"pending_2nd","LOAN_STATUS_SENT_BACK",0,"sent_back","isLoanClosed",0,e=>t.includes(e)])},60087,e=>{"use strict";var t=e.i(64397);let s=async e=>{let t=await e.json();if(!e.ok){if(t&&(422===e.status||409===e.status)){let e=Error(t.error||t.message||"Validation failed");throw e.errors=t.errors,e}throw Error(t.error||t.message||"Request failed")}return t};e.s(["groupService",0,{getGroups:async()=>{try{let e=await fetch(`${t.API_BASE_URL}/groups`,{headers:(0,t.getHeaders)()});return(await s(e)).data||[]}catch(e){return console.error("Failed to fetch groups:",e),[]}},getGroupById:async e=>{try{let r=await fetch(`${t.API_BASE_URL}/groups/${e}`,{headers:(0,t.getHeaders)()});return(await s(r)).data}catch(e){throw console.error("Failed to fetch group:",e),e}},createGroup:async e=>{try{let r=await fetch(`${t.API_BASE_URL}/groups`,{method:"POST",headers:(0,t.getHeaders)(),body:JSON.stringify(e)});return(await s(r)).data}catch(e){throw console.error("Failed to create group:",e),e}},updateGroup:async(e,r)=>{try{let a=await fetch(`${t.API_BASE_URL}/groups/${e}`,{method:"PUT",headers:(0,t.getHeaders)(),body:JSON.stringify(r)});return(await s(a)).data}catch(e){throw console.error("Failed to update group:",e),e}},deleteGroup:async e=>{try{let r=await fetch(`${t.API_BASE_URL}/groups/${e}`,{method:"DELETE",headers:(0,t.getHeaders)()});await s(r)}catch(e){throw console.error("Failed to delete group:",e),e}},toggleGroupStatus:async(e,r)=>{let a="active"===r.toLowerCase()?"inactive":"active";try{let r=await fetch(`${t.API_BASE_URL}/groups/${e}`,{method:"PUT",headers:(0,t.getHeaders)(),body:JSON.stringify({status:a})});return(await s(r)).data}catch(e){throw console.error("Failed to update group status:",e),e}}}])},17918,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(55436),a=e.i(7233),l=e.i(14606),n=e.i(61911),i=e.i(25652);let o=(0,e.i(75254).default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var c=e.i(27331),d=e.i(658),u=e.i(25859),m=e.i(42365),h=e.i(37727),x=e.i(43531),g=e.i(31278),p=e.i(63209);function b({isOpen:e,onClose:a,onSubmit:l,initialData:n}){let[i,o]=(0,s.useState)([]),[b,f]=(0,s.useState)([]),[y,j]=(0,s.useState)([]),[v,N]=(0,s.useState)(!1),[w,_]=(0,s.useState)(!1),[S,C]=(0,s.useState)(""),[A,k]=(0,s.useState)(n?.center_id||""),[E,P]=(0,s.useState)(n?.group_name||"");(0,s.useEffect)(()=>{let t=async()=>{N(!0);try{let e=await d.centerService.getCenters(),t=m.authService.getCurrentUser(),s=m.authService.hasRole("field_officer"),r=e.filter(e=>"active"===e.status);s&&t&&(r=r.filter(e=>e.staff_id===t.user_name)),o(r)}catch(e){console.error("Failed to load centers:",e)}finally{N(!1)}};e&&(t(),n?(k(n.center_id),P(n.group_name)):(j([]),k(""),P(""),C("")))},[e,n]),(0,s.useEffect)(()=>{let t=async()=>{if(!A)return void f([]);_(!0);try{let e=await u.customerService.getCustomers({center_id:A}),t=e.filter(e=>!e.grp_id||n?.id&&e.grp_id===n.id);if(f(t),n?.customer_ids&&n.customer_ids.length>0){let t=e.filter(e=>n.customer_ids?.includes(e.id.toString()));j(t)}}catch(e){console.error("Failed to load customers:",e)}finally{_(!1)}};e&&A&&t()},[A,e,n]);let $=e=>{e.preventDefault(),3!==y.length||l({id:n?.id,group_name:E,center_id:A,customer_ids:y.map(e=>e.id.toString()),status:n?.status||"active"})},L=b.filter(e=>e.full_name.toLowerCase().includes(S.toLowerCase())||e.customer_code.toLowerCase().includes(S.toLowerCase())),U=!E.trim()||!A||3!==y.length||v;return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl max-w-lg w-full shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[(0,t.jsxs)("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between bg-white",children:[(0,t.jsx)("div",{children:(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:n?"Edit Group":"Add New Group"})}),(0,t.jsx)("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,t.jsx)(h.X,{size:20,className:"text-gray-500"})})]}),(0,t.jsxs)("form",{onSubmit:$,className:"flex-1 overflow-y-auto p-6 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"Group Name *"}),(0,t.jsx)("input",{type:"text",value:E,onChange:e=>P(e.target.value),required:!0,className:"w-full px-4 py-2.5 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none text-sm placeholder:text-gray-400",placeholder:"Enter group name"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-1.5",children:"Center *"}),(0,t.jsxs)("select",{value:A,onChange:e=>{k(e.target.value),j([])},required:!0,className:"w-full px-4 py-2.5 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 transition-all outline-none appearance-none text-sm",disabled:v,children:[(0,t.jsx)("option",{value:"",children:"Select Center"}),i.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.center_name,e.CSU_id?` (${e.CSU_id})`:""]},e.id))]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-700",children:"Select Customers (max 3)"}),(0,t.jsxs)("span",{className:`text-xs font-bold py-1 px-2 rounded-lg ${3===y.length?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:[y.length," / 3 selected"]})]}),A?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-3 flex items-center pointer-events-none",children:(0,t.jsx)(r.Search,{size:16,className:"text-gray-400 group-focus-within:text-blue-500 transition-colors"})}),(0,t.jsx)("input",{type:"text",value:S,onChange:e=>C(e.target.value),placeholder:"Search by name or NIC",className:"w-full pl-10 pr-4 py-2.5 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition-all text-sm"})]}),(0,t.jsx)("div",{className:"border border-gray-200 rounded-2xl max-h-[220px] overflow-y-auto divide-y divide-gray-100 shadow-sm",children:w?(0,t.jsxs)("div",{className:"p-8 flex flex-col items-center justify-center space-y-2",children:[(0,t.jsx)(g.Loader2,{size:24,className:"animate-spin text-blue-500"}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"Fetching customers..."})]}):L.length>0?L.map(e=>{let s=y.find(t=>t.id===e.id),r=e.loans?.find(e=>!(0,c.isLoanClosed)(e.status||"")&&Number(e.outstanding_amount)>0);return(0,t.jsxs)("div",{onClick:()=>!r&&(e=>{if(y.find(t=>t.id===e.id))j(y.filter(t=>t.id!==e.id));else{if(y.length>=3)return;j([...y,e])}})(e),className:`p-3.5 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors ${s?"bg-blue-50/30":""} ${r?"opacity-60 cursor-not-allowed bg-gray-50":""}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center font-bold text-xs ${s?"bg-blue-600 text-white shadow-md shadow-blue-100":"bg-gray-100 text-gray-500"}`,children:e.full_name.charAt(0)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-800 leading-none truncate",children:e.full_name}),r&&(0,t.jsxs)("span",{className:"text-[9px] font-bold text-red-600 bg-red-50 border border-red-100 px-1.5 py-0.5 rounded",children:["Has Active Loan (",r.loan_id,")"]})]}),(0,t.jsx)("p",{className:"text-[11px] text-gray-400 font-mono mt-1",children:e.customer_code})]})]}),s?(0,t.jsx)("div",{className:"w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center",children:(0,t.jsx)(x.Check,{size:12,className:"text-white",strokeWidth:3})}):(0,t.jsx)("div",{className:"w-5 h-5 border border-gray-300 rounded-full"})]},e.id)}):(0,t.jsx)("div",{className:"p-8 text-center",children:(0,t.jsx)("p",{className:"text-sm text-gray-400",children:"No available customers found in this center."})})})]}):(0,t.jsx)("div",{className:"p-10 border border-gray-100 bg-gray-50/50 rounded-2xl flex flex-col items-center justify-center text-center",children:(0,t.jsx)("p",{className:"text-sm text-gray-400",children:"Select a center to view customers."})}),y.length>0&&3!==y.length&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-amber-600 bg-amber-50 p-2 rounded-lg",children:[(0,t.jsx)(p.AlertCircle,{size:14}),(0,t.jsx)("p",{className:"text-[11px] font-medium",children:"Please select exactly 3 customers to create a group."})]})]})]}),(0,t.jsxs)("div",{className:"p-6 border-t border-gray-100 flex gap-3 justify-end bg-white",children:[(0,t.jsx)("button",{type:"button",onClick:a,className:"px-6 py-2.5 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 transition-all font-semibold text-sm text-gray-600",children:"Cancel"}),(0,t.jsx)("button",{onClick:$,disabled:U,className:"px-8 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 active:scale-[0.98] transition-all font-semibold text-sm shadow-lg shadow-blue-200 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed",children:n?"Update Group":"Add Group"})]})]})}):null}var f=e.i(88511),y=e.i(27612),j=e.i(81203),v=e.i(13130),N=e.i(4405);function w({groups:e,totalGroups:s,onEdit:r,onViewMembers:a,onDelete:n,onToggleStatus:i}){let{currentPage:o,itemsPerPage:c,startIndex:d,endIndex:u,handlePageChange:m,handleItemsPerPageChange:h}=(0,v.usePagination)({totalItems:e.length}),x=e.slice(d,u);return(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-3",children:(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-4 text-xs font-semibold text-gray-600 uppercase",children:[(0,t.jsx)("div",{className:"col-span-3",children:"Group"}),(0,t.jsx)("div",{className:"col-span-3",children:"Center"}),(0,t.jsx)("div",{className:"col-span-2",children:"Branch"}),(0,t.jsx)("div",{className:"col-span-2",children:"Members"}),(0,t.jsx)("div",{className:"col-span-1",children:"Status"}),(0,t.jsx)("div",{className:"col-span-1",children:"Actions"})]})}),(0,t.jsx)("div",{className:"divide-y divide-gray-100",children:x.map(e=>(0,t.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-center",children:[(0,t.jsxs)("div",{className:"col-span-3 flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,t.jsx)(l.UsersRound,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900 truncate",children:e.group_name}),e.group_code&&(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.group_code})]})]}),(0,t.jsxs)("div",{className:"col-span-3",children:[(0,t.jsx)("p",{className:"text-sm text-gray-900",children:e.center?.center_name||e.center_id}),e.center?.CSU_id&&(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.center.CSU_id})]}),(0,t.jsx)("div",{className:"col-span-2",children:(0,t.jsx)("p",{className:"text-sm text-gray-900",children:e.center?.branch?.branch_name||e.branch?.branch_name||"N/A"})}),(0,t.jsx)("div",{className:"col-span-2",children:(0,t.jsx)("button",{onClick:()=>a(e),className:"text-left group",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[e.customers&&e.customers.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"flex -space-x-2 mb-1",children:e.customers.slice(0,3).map((e,s)=>(0,t.jsx)("div",{className:"w-6 h-6 rounded-full bg-blue-100 border-2 border-white flex items-center justify-center text-[10px] font-bold text-blue-600",title:e.full_name,children:e.full_name.charAt(0)},e.id))}),(0,t.jsxs)("p",{className:"text-xs font-medium text-blue-600 group-hover:text-blue-700 truncate w-32",children:[e.customers[0].full_name,e.customers.length>1&&` + ${e.customers.length-1} more`]})]}):(0,t.jsxs)("p",{className:"text-sm text-gray-500 font-medium",children:[e.customers_count||0," Members"]}),(0,t.jsxs)("p",{className:"text-[10px] text-gray-400 mt-0.5",children:[e.loans_count??0," active loans"]})]})})}),(0,t.jsx)("div",{className:"col-span-1",children:(0,t.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium capitalize ${"active"===e.status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:e.status})}),(0,t.jsxs)("div",{className:"col-span-1 flex items-center gap-1",children:[i&&(0,t.jsx)("button",{onClick:()=>i(e),className:`p-1.5 rounded transition-colors ${"inactive"===e.status?"hover:bg-green-50 text-green-600":"hover:bg-amber-50 text-amber-600"}`,title:"inactive"===e.status?"Enable Group":"Disable Group",children:(0,t.jsx)(j.Power,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:()=>r(e),className:"p-1.5 hover:bg-blue-50 rounded text-blue-600","aria-label":"Edit group",children:(0,t.jsx)(f.Edit,{className:"w-4 h-4"})}),n&&(0,t.jsx)("button",{onClick:()=>n(e.id),className:"p-1.5 hover:bg-red-50 rounded text-red-600","aria-label":"Delete group",children:(0,t.jsx)(y.Trash2,{className:"w-4 h-4"})})]})]})},e.id))}),(0,t.jsx)(N.Pagination,{currentPage:o,totalItems:e.length,itemsPerPage:c,onPageChange:m,onItemsPerPageChange:h,itemName:"groups"})]})}var _=e.i(70319);function S({isOpen:e,onClose:s,group:r}){if(!e||!r)return null;let a=r.members||[],l=r.customers||[],n=l.length>0?l.length:a.length;return(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-xl",children:[(0,t.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:r.group_name}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[n," ",1===n?"Member":"Members"]})]}),(0,t.jsx)("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded transition-colors",children:(0,t.jsx)(h.X,{className:"w-5 h-5 text-gray-500"})})]})}),(0,t.jsx)("div",{className:"p-6",children:r.customers&&r.customers.length>0?(0,t.jsx)("div",{className:"space-y-3",children:r.customers.map(e=>{let s=Number(e.center_id)!==Number(r.center_id);return(0,t.jsxs)("div",{className:`flex items-center justify-between p-4 border rounded-lg transition-colors ${s?"bg-amber-50 border-amber-200":"border-gray-200 hover:bg-gray-50"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shadow-lg ${s?"bg-amber-500 shadow-amber-100":"bg-blue-600 shadow-blue-100"}`,children:(0,t.jsx)("span",{className:"text-white text-base font-bold",children:e.full_name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"font-bold text-gray-900",children:e.full_name}),s&&(0,t.jsx)("span",{className:"px-1.5 py-0.5 bg-amber-100 text-amber-700 text-[10px] uppercase font-bold rounded border border-amber-200",children:"Transferred"}),e.loans?.find(e=>!(0,c.isLoanClosed)(e.status||""))&&(0,t.jsxs)("span",{className:"px-1.5 py-0.5 bg-red-50 text-red-600 text-[10px] font-bold rounded border border-red-100 flex items-center gap-1",children:[(0,t.jsx)("span",{className:"w-1 h-1 bg-red-600 rounded-full animate-pulse"}),"Has Active Loan (",e.loans.find(e=>!(0,c.isLoanClosed)(e.status||""))?.loan_id,")"]})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 font-mono uppercase",children:e.customer_code}),s&&(0,t.jsxs)("p",{className:"text-[10px] text-amber-600 mt-0.5 font-medium",children:["Transferred to: ",e.center?.center_name||`#${e.center_id}`]})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("span",{className:`inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-bold capitalize ${"active"===e.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:e.status||"Active"}),(0,t.jsxs)("div",{className:"text-[10px] text-gray-500 mt-1.5 font-medium space-y-0.5",children:[(0,t.jsxs)("p",{className:"flex items-center justify-end gap-1",children:[(0,t.jsx)("span",{className:"text-gray-400 uppercase text-[9px]",children:"Branch:"}),e.branch?.branch_name||"N/A"]}),(0,t.jsxs)("p",{className:"flex items-center justify-end gap-1",children:[(0,t.jsx)("span",{className:"text-gray-400 uppercase text-[9px]",children:"Center:"}),e.center?.center_name||"N/A"]})]})]})]},e.id)})}):a.length>0?(0,t.jsx)("div",{className:"space-y-3",children:a.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white text-sm font-semibold",children:e.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.customer_id})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium capitalize ${"active"===e.status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:e.status}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Joined ",new Date(e.joined_date).toLocaleDateString()]})]})]},e.id))}):(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-gray-500",children:"No members in this group yet."})})}),(0,t.jsxs)("div",{className:"p-4 border-t border-gray-200 flex gap-3 justify-end bg-gray-50",children:[(0,t.jsxs)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm flex items-center gap-2",onClick:()=>_.toast.info("Add member functionality coming soon!"),children:[(0,t.jsx)(o,{className:"w-4 h-4"}),"Add Member"]}),(0,t.jsx)("button",{onClick:s,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-white transition-colors font-medium text-sm",children:"Close"})]})]})})}var C=e.i(60087);function A(){let[e,c]=(0,s.useState)([]),[d,u]=(0,s.useState)(!0),[m,h]=(0,s.useState)(null),[x,g]=(0,s.useState)(!1),[p,f]=(0,s.useState)(!1),[y,j]=(0,s.useState)(null),[v,N]=(0,s.useState)("");(0,s.useEffect)(()=>{A()},[]);let A=async()=>{try{u(!0);let e=await C.groupService.getGroups();c(e),h(null)}catch(e){console.error("Failed to load groups:",e),h(e.message||"Failed to load groups. Please check your connection.")}finally{u(!1)}},k=async t=>{try{let s=await C.groupService.createGroup(t);c([...e,s]),g(!1),_.toast.success("Group created successfully!")}catch(t){console.error("Failed to create group:",t);let e=t.errors?Object.values(t.errors).flat().join(", "):t.message||"Failed to create group";_.toast.error(e)}},E=async t=>{if(y)try{let s=await C.groupService.updateGroup(y.id,t);c(e.map(e=>e.id===y.id?s:e)),g(!1),j(null),_.toast.success("Group updated successfully!")}catch(t){console.error("Failed to update group:",t);let e=t.errors?Object.values(t.errors).flat().join(", "):t.message||"Failed to update group";_.toast.error(e)}},P=async e=>{try{await C.groupService.toggleGroupStatus(e.id,e.status),_.toast.success(`Group ${"active"===e.status?"disabled":"enabled"} successfully!`),A()}catch(t){console.error("Failed to update group status:",t);let e=t.errors?Object.values(t.errors).flat().join(", "):t.message||"Failed to update group status";_.toast.error(e)}},$=async t=>{if(window.confirm("Are you sure you want to delete this group?"))try{await C.groupService.deleteGroup(t),c(e.filter(e=>e.id!==t)),_.toast.success("Group deleted successfully!")}catch(e){console.error("Failed to delete group:",e),_.toast.error(e.message||"Failed to delete group")}},L=e.filter(e=>e.group_name.toLowerCase().includes(v.toLowerCase())||e.group_code&&e.group_code.toLowerCase().includes(v.toLowerCase())||e.center?.center_name&&e.center.center_name.toLowerCase().includes(v.toLowerCase())),U=e.length,T=e.filter(e=>"active"===e.status).length,R=e.reduce((e,t)=>e+(t.member_count||t.customers?.length||t.members?.length||0),0),I=U>0?Math.round(R/U):0;return d?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):m?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-red-600",children:[(0,t.jsx)("p",{children:m}),(0,t.jsx)("button",{onClick:A,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm",children:"Retry"})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Group Management"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Manage self-help groups and their members"})]}),(0,t.jsxs)("button",{onClick:()=>{j(null),g(!0)},className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:[(0,t.jsx)(a.Plus,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Add Group"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-5 hover:shadow-md transition-shadow",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(l.UsersRound,{className:"w-5 h-5 text-blue-600"})})}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Total Groups"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:U})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-5 hover:shadow-md transition-shadow",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(i.TrendingUp,{className:"w-5 h-5 text-green-600"})}),U>0&&(0,t.jsxs)("span",{className:"text-xs font-medium text-gray-600",children:[(T/U*100).toFixed(0),"%"]})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Active Groups"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:T})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-5 hover:shadow-md transition-shadow",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(n.Users,{className:"w-5 h-5 text-purple-600"})})}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Total Members"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:R})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-5 hover:shadow-md transition-shadow",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(o,{className:"w-5 h-5 text-orange-600"})})}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Avg Members/Group"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:I})]})]}),(0,t.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(r.Search,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),(0,t.jsx)("input",{type:"text",placeholder:"Search groups by name, code, or center...",value:v,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,t.jsx)(w,{groups:L,totalGroups:U,onEdit:e=>{j(e),g(!0)},onViewMembers:e=>{j(e),f(!0)},onDelete:$,onToggleStatus:P}),0===L.length&&(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-8 text-center",children:[(0,t.jsx)(l.UsersRound,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No groups found"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Try adjusting your search or create a new group."})]}),(0,t.jsx)(b,{isOpen:x,onClose:()=>{g(!1),j(null)},onSubmit:y?E:k,initialData:y?{id:y.id,group_name:y.group_name,center_id:y.center_id,branch_id:(y.branch_id||y.center?.branch_id)?.toString(),status:y.status,customer_ids:y.customers?.map(e=>e.id.toString())}:null}),(0,t.jsx)(S,{isOpen:p,onClose:()=>{f(!1),j(null)},group:y})]})}var k=e.i(18566);function E(){let[e,r]=(0,s.useState)(null),a=(0,k.useRouter)();return((0,s.useEffect)(()=>{{let e,t;r((e=m.authService.hasPermission("groups.view"),t=m.authService.hasRole("super_admin"),!!e||!!t||(a.push("/"),!1)))}},[a]),!1===e)?null:null===e?(0,t.jsx)("div",{className:"p-6",children:"Loading groups..."}):(0,t.jsx)(A,{})}e.s(["default",()=>E],17918)}]);